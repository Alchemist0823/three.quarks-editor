{"version":3,"sources":["components/MainMenu.tsx","WebGL.ts","../../three.quarks/dist/three.quarks.esm.js","example/ToonProjectile.ts","example/BulletMuzzle.ts","example/BulletProjectile.ts","example/BulletHit.ts","example/ToonExplosion.ts","example/Explosion.ts","components/ApplicationContext.tsx","components/ThreejsViewport.tsx","components/editors/NumberInput.tsx","components/editors/Vector3Editor.tsx","components/editors/StringInput.tsx","components/ObjectProperties.tsx","components/editors/ColorEditor.tsx","components/editors/bezier/TransformComponent.tsx","components/editors/bezier/CurveComponent.tsx","components/editors/bezier/HandleComponent.tsx","components/editors/bezier/BezierCurvesEditor.tsx","components/editors/GeneratorEditor.tsx","components/ParticleSystemProperties.tsx","components/editors/FileInput.tsx","components/ParticleRendererProperties.tsx","components/editors/ScriptEditor.tsx","components/ScriptProperties.tsx","components/EmitterShapeProperties.tsx","components/ParticleSystemController.tsx","components/BehaviorsProperties.tsx","components/PropertiesEditor.tsx","components/SceneGraphViewMaterial.tsx","components/Application.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["styles","createStyles","theme","root","flexGrow","menuIcon","marginRight","spacing","menuButton","title","MainMenu","props","fileRef","openFileDialog","e","current","click","importFile","target","files","onImport","openDemo","demoIndex","onOpenDemo","handleMenuClick","event","console","log","currentTarget","setState","anchorEl","handleMenuClose","undefined","state","React","classes","this","className","AppBar","position","Toolbar","variant","IconButton","edge","color","aria-label","Typography","Button","aria-controls","aria-haspopup","onClick","id","Menu","keepMounted","open","Boolean","onClose","MenuItem","onSaveAs","ref","type","multiple","accept","style","display","onChange","withStyles","withTheme","WEBGL","isWebGLAvailable","canvas","document","createElement","window","WebGLRenderingContext","getContext","isWebGL2Available","WebGL2RenderingContext","getWebGLErrorMessage","getErrorMessage","getWebGL2ErrorMessage","version","contexts","1","2","message","element","fontFamily","fontSize","fontWeight","textAlign","background","padding","width","margin","replace","innerHTML","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","RenderMode","particle_frag","particle_vert","local_particle_vert","stretched_bb_particle_vert","_Mesh","ParticleEmitter","_super","system","parameters","_this","call","geometry","renderMode","BillBoard","speedFactor","instancingGeometry","Float32Array","uniforms","defines","interleavedBuffer","setIndex","setAttribute","offsetBuffer","maxParticle","setUsage","colorBuffer","rotationBuffer","sizeBuffer","tiling","texture","copy","matrix","uTileCount","vTileCount","tileCount","uvTileBuffer","worldSpace","LocalSpaceBillBoard","vertexShader","side","material","fragmentShader","transparent","depthWrite","blending","StretchedBillBoard","Error","velocityBuffer","frustumCulled","particles","particleNum","instanceCount","i","particle","setXYZ","x","y","z","setXYZW","w","setX","rotation","size","velocity","uvTile","updateRange","count","needsUpdate","dispose","cache","values","data","metadata","push","meta","isRootObject","output","geometries","materials","textures","images","shapes","generator","object","uuid","name","castShadow","receiveShadow","visible","renderOrder","JSON","stringify","userData","layers","mask","toArray","matrixAutoUpdate","ps","toJSON","children","length","extractFromCache","Particle","ConstantValue","json","IntervalValue","a","b","lerp","Math","random","PiecewiseFunction","functions","Array","t","mid","left","right","getStartX","getEndX","index","func","get","Bezier","p1","p2","p3","p4","p","t2","t3","mt","mt2","mt3","points","dpoints","c","list","j","dpt","derivativeCoefficients","d0","d1","pt","_p","q","idx","l","hull","span","p0","_PiecewiseFunction","PiecewiseBezier","_super2","_this2","curves","arguments","findFunction","error","genValue","segments","result","join","map","_ref","_ref2","bezier","start","function","piecewiseFunction","fromJSON","ValueGeneratorFromJSON","ColorToJSON","r","g","RandomColor","rand","ColorRange","ConstantColor","ColorGeneratorFromJSON","ColorOverLife","delta","genColor","age","life","dot","startColor","RotationOverLife","angularVelocityFunc","angularVelocity","SizeOverLife","startSize","FrameOverLife","floor","ConeEmitter","radius","arc","PI","thickness","angle","u","theta","sqrt","sinTheta","sin","cosTheta","cos","set","addScaledVector","multiplyScalar","startSpeed","SphereEmitter","v","phi","acos","cbrt","sinPhi","cosPhi","setScalar","PointEmitter","DonutEmitter","ParticleSystem","autoDestroy","duration","looping","startLife","startRotation","emissionOverTime","emissionOverDistance","emissionBursts","emitterShape","shape","behaviors","startTileIndex","emitter","burstIndex","burstWaveIndex","time","paused","waitEmiting","emitEnded","markForDestroy","initialize","applyMatrix4","matrixWorld","applyMatrix3","normalMatrix","parent","remove","endEmit","getNormalMatrix","spawn","probability","_i","_particle","update","image","url","from","array","behavior","BehaviorFromJSON","TEXTURE_MAPPING","UVMapping","CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","CubeUVReflectionMapping","CubeUVRefractionMapping","TEXTURE_WRAPPING","RepeatWrapping","ClampToEdgeWrapping","MirroredRepeatWrapping","TEXTURE_FILTER","NearestFilter","NearestMipmapNearestFilter","NearestMipmapLinearFilter","LinearFilter","LinearMipmapNearestFilter","LinearMipmapLinearFilter","QuarksLoader","manager","resourcePath","path","crossOrigin","onLoad","onProgress","onError","scope","extractUrlBase","loader","setPath","load","text","parse","toLowerCase","itemStart","itemEnd","itemError","setCrossOrigin","il","isArray","jl","currentUrl","test","loadImage","parseConstant","warn","mapping","offset","fromArray","repeat","center","wrap","wrapS","wrapT","format","encoding","minFilter","magFilter","anisotropy","flipY","premultiplyAlpha","unpackAlignment","decompose","quaternion","scale","add","parseObject","parseImages","parseTextures","_PiecewiseFunction2","Gradient","_super3","_this3","getFunction","_ref3","_ref4","range","ToonProjectile","smoke","glowBeam","mainBeam","TextureLoader","Vector4","AdditiveBlending","addBehavior","NormalBlending","rotateY","Group","BulletMuzzle","beam","muzzle1","muzzle2","flash","cycle","interval","muzzle","BulletProjectile","hProjectile","vProjectile","projectileParam","BulletHit","ToonExplosion","circle","Explosion","gatherParticles","mainColor","yellowColor","secColor","yellowColor2","ApplicationContext","ApplicationContextConsumer","Consumer","ApplicationContextProvider","removeObject3d","object3D","addObject3d","scene","Mesh","BoxBufferGeometry","MeshStandardMaterial","actions","select","animate","updateProperties","createScene","script","selection","file","Blob","href","URL","createObjectURL","download","nFiles","nFileId","jsonURL","selectAddition","indexOf","duplicateObject3d","updateParticleSystem","demoObject","THREE","Color","Function","axisHelper","AxesHelper","light","PointLight","ambientLight","AmbientLight","Provider","ThreejsViewport","container","stats","camera","renderer","clock","controls","appContext","onResize","domElement","parentElement","clientWidth","clientHeight","height","newWidth","newHeight","aspect","updateProjectionMatrix","setSize","requestAnimationFrame","renderScene","init","prevProps","prevState","snapshot","body","appendChild","WebGLRenderer","Clock","PerspectiveCamera","OrbitControls","enableKeys","enableDamping","dampingFactor","rotateSpeed","setPixelRatio","devicePixelRatio","Stats","dom","getDelta","traverse","render","context","NumberInput","inputValue","setInputValue","focus","setFocus","onBlur","parseFloat","onFocus","onKeyDown","Vector3Editor","unitConversion","StringInput","ObjectProperties","onChangeName","object3d","onChangePosition","onChangeScale","onChangeRotation","ConvertToColor","ColorEditor","setOpen","backgroundColor","colorResult","min","rgb","interp","TransformComponent","xFrom","xTo","yFrom","yTo","nextProps","Component","CurveComponent","curveColor","curveWidth","curve","fill","stroke","strokeWidth","d","HandleComponent","xstart","ystart","handleRadius","handleColor","hover","down","handleStroke","xval","yval","onMouseEnter","onMouseLeave","onMouseDown","sx","sy","cx","cy","atan2","cxs","cys","x1","y1","x2","y2","BezierCurvesEditor","rootRef","createRef","positionForEvent","rect","getBoundingClientRect","clientX","clientY","top","inversex","inversey","onDownLeave","onDownMove","preventDefault","curveIndex","old","setStartX","pCurve","setFunction","clone","setEndX","numOfFunctions","nCurve","onDownUp","h","defaultP","slope0","getSlope","slope1","onDownHandle","onEnterHandle","onLeaveHandle","onMouseMove","onMouseUp","ValueToEditor","GeneratorEditor","changeEditor","updateGenerator","changeValue","changeColor","changeValueA","changeValueB","changeColorRangeA","colorRange","changeColorRangeB","changeRandomColorA","randomColor","changeRandomColorB","changeCurve","allowedType","editorTypes","valueType","editorType","editor","currentEditor","getEditorType","selected","ParticleSystemProperties","onChangeStartSpeed","particleSystem","onChangeStartLife","onChangeStartSize","onChangeStartColor","OnChangeStartRotation","OnChangeEmissionOverTime","valueFunctionTypes","colorValueFunctionTypes","FileInput","handleChange","fileName","ParticleRendererProperties","onChangeTexture","Texture","onload","reader","FileReader","src","readAsDataURL","onChangeStartTile","onChangeUTileCount","onChangeVTileCount","onChangeBlending","getValueOfBlending","ScriptEditor","onValueChange","highlight","code","languages","javascript","ScriptProperties","onChangeScript","EmitterShapeProperties","getValueOfShape","onChangeShape","onChangeKeyValue","k","properties","renderShapeProperties","PureComponent","ParticleSystemController","getSystems","systems","checkPause","forEach","togglePause","play","pause","onRestart","restart","onStop","ToggleButtonGroup","ButtonGroup","disabled","useStyles","makeStyles","listRoot","palette","paper","BehaviorsProperties","checked","setChecked","selectedIndex","setSelectedIndex","setAnchorEl","handleClose","onChangeBehaviorFunc","List","dense","valueTypes","labelId","ListItem","handleListItemClick","ListItemIcon","Checkbox","currentIndex","newChecked","splice","inputProps","ListItemText","primary","secondary","Accordion","border","boxShadow","borderBottom","expanded","MuiAccordion","AccordionSummary","marginBottom","minHeight","content","expandIcon","MuiAccordionSummary","heading","typography","pxToRem","fontWeightRegular","PropertiesEditor","AccordionDetails","SceneGraphViewMaterial","useState","setSelected","handleSelect","nodeIds","countIndex","res","parseInt","getObjectName","TreeView","onNodeSelect","defaultCollapseIcon","defaultExpandIcon","renderObject","items","originIndex","TreeItem","nodeId","label","Application","createMuiTheme","main","blue","red","App","ThemeProvider","location","hostname","match","ReactDOM","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.6fe8a7a4.chunk.js","sourcesContent":["import * as React from \"react\";\r\nimport Button from '@material-ui/core/Button';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport {createStyles, Theme, Typography, Toolbar} from \"@material-ui/core\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport withStyles from \"@material-ui/core/styles/withStyles\";\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\n\r\ninterface MainMenuProps {\r\n    onSaveAs: () => void;\r\n    onImport: (files: FileList) => void;\r\n    onOpenDemo: (demoIndex: number) => void;\r\n    classes: any\r\n}\r\n\r\ninterface MainMenuState {\r\n    anchorEl?: Element\r\n}\r\n\r\nconst styles = createStyles((theme: Theme) => ({\r\n    root: {\r\n        flexGrow: 1,\r\n    },\r\n    menuIcon: {\r\n        marginRight: theme.spacing(2),\r\n    },\r\n    menuButton: {\r\n        marginRight: theme.spacing(1),\r\n    },\r\n    title: {\r\n        marginRight: theme.spacing(1),\r\n        //flexGrow: 1,\r\n    },\r\n}));\r\n\r\nclass MainMenu extends React.PureComponent<MainMenuProps, MainMenuState> {\r\n    private fileRef: React.RefObject<HTMLInputElement>;\r\n\r\n    constructor(props: Readonly<MainMenuProps>) {\r\n        super(props);\r\n        this.state = {\r\n            anchorEl: undefined\r\n        }\r\n\r\n        this.fileRef = React.createRef();\r\n    }\r\n\r\n    openFileDialog = (e: React.MouseEvent<Element, MouseEvent>) => {\r\n        if (this.fileRef.current)\r\n            this.fileRef.current.click();\r\n    };\r\n\r\n    importFile = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files)\r\n            this.props.onImport(e.target.files);\r\n    };\r\n\r\n    openDemo = (demoIndex: number) => {\r\n        this.props.onOpenDemo(demoIndex);\r\n    };\r\n\r\n    handleMenuClick = (event: React.MouseEvent<Element, MouseEvent>) => {\r\n        console.log(event.currentTarget);\r\n        this.setState({anchorEl: event.currentTarget});\r\n    };\r\n\r\n    handleMenuClose = () => {\r\n        this.setState({anchorEl: undefined});\r\n    };\r\n\r\n    render() {\r\n        //<Image size='mini' src='/logo.png' style={{ marginRight: '1.5em' }} />\r\n        //<MenuIcon />\r\n        //<IconButton edge=\"start\" className={classes.menuButton} color=\"inherit\" aria-label=\"menu\">\r\n        //</IconButton>\r\n        const {classes} = this.props;\r\n        return (\r\n            <div className={classes.root}>\r\n                <AppBar position=\"static\">\r\n                    <Toolbar variant=\"dense\">\r\n                        <IconButton edge=\"start\" className={classes.menuIcon} color=\"inherit\" aria-label=\"menu\">\r\n                            <MenuIcon/>\r\n                        </IconButton>\r\n                        <Typography variant=\"h6\" className={classes.title}>\r\n                            Three.Quarks\r\n                        </Typography>\r\n                        <Button color=\"inherit\" className={classes.menuButton} aria-controls=\"simple-menu\"\r\n                                aria-haspopup=\"true\" onClick={this.handleMenuClick} id=\"file-button\">\r\n                            File\r\n                        </Button>\r\n                        <Menu\r\n                            id=\"file-menu\"\r\n                            anchorEl={this.state.anchorEl}\r\n                            keepMounted\r\n                            open={Boolean(this.state.anchorEl && this.state.anchorEl.id === \"file-button\")}\r\n                            onClose={this.handleMenuClose}\r\n                        >\r\n                            <MenuItem>New</MenuItem>\r\n                            <MenuItem onClick={this.openFileDialog}>Open</MenuItem>\r\n                            <MenuItem onClick={this.props.onSaveAs}>Download</MenuItem>\r\n                            <input ref={this.fileRef} type=\"file\" id=\"fileElem\" multiple accept=\"application/json\"\r\n                                   style={{display: \"none\"}}\r\n                                   onChange={this.importFile}/>\r\n                        </Menu>\r\n                        <Button color=\"inherit\" className={classes.menuButton} aria-controls=\"simple-menu\"\r\n                                aria-haspopup=\"true\" onClick={this.handleMenuClick} id=\"demo-button\">\r\n                            Demo\r\n                        </Button>\r\n                        <Menu\r\n                            id=\"demo-menu\"\r\n                            anchorEl={this.state.anchorEl}\r\n                            keepMounted\r\n                            open={Boolean(this.state.anchorEl && this.state.anchorEl.id === \"demo-button\")}\r\n                            onClose={this.handleMenuClose}\r\n                        >\r\n                            <MenuItem onClick={() => this.openDemo(0)}>Demo 1</MenuItem>\r\n                            <MenuItem onClick={() => this.openDemo(1)}>Demo 2</MenuItem>\r\n                            <MenuItem onClick={() => this.openDemo(2)}>Demo 3</MenuItem>\r\n                            <MenuItem onClick={() => this.openDemo(3)}>Demo 4</MenuItem>\r\n                            <MenuItem onClick={() => this.openDemo(4)}>Demo 5</MenuItem>\r\n                            <MenuItem onClick={() => this.openDemo(5)}>Demo Explosion</MenuItem>\r\n                        </Menu>\r\n                    </Toolbar>\r\n                </AppBar>\r\n            </div>);\r\n    }\r\n}\r\n\r\nexport default withStyles(styles, {withTheme: true})(MainMenu);","/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mr.doob / http://mrdoob.com/\r\n */\r\n\r\nexport const WEBGL = {\r\n    isWebGLAvailable: function () {\r\n\r\n        try {\r\n            const canvas = document.createElement( 'canvas' );\r\n            // @ts-ignore\r\n            return !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) );\r\n        } catch ( e ) {\r\n            return false;\r\n        }\r\n\r\n    },\r\n\r\n    isWebGL2Available: function () {\r\n        try {\r\n            const canvas = document.createElement( 'canvas' );\r\n            // @ts-ignore\r\n            return !! ( window.WebGL2RenderingContext && canvas.getContext( 'webgl2' ) );\r\n        } catch ( e ) {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    getWebGLErrorMessage: function () {\r\n        return this.getErrorMessage( 1 );\r\n    },\r\n\r\n    getWebGL2ErrorMessage: function () {\r\n        return this.getErrorMessage( 2 );\r\n    },\r\n\r\n    getErrorMessage: function ( version: number ) {\r\n        const names :{[version:number]: string} = {\r\n            1: 'WebGL',\r\n            2: 'WebGL 2'\r\n        };\r\n\r\n        const contexts :{[version:number]: string} = {\r\n            // @ts-ignore\r\n            1: window.WebGLRenderingContext,\r\n            // @ts-ignore\r\n            2: window.WebGL2RenderingContext\r\n        };\r\n\r\n        let message = 'Your $0 does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">$1</a>';\r\n\r\n        const element = document.createElement( 'div' );\r\n        element.id = 'webglmessage';\r\n        element.style.fontFamily = 'monospace';\r\n        element.style.fontSize = '13px';\r\n        element.style.fontWeight = 'normal';\r\n        element.style.textAlign = 'center';\r\n        element.style.background = '#fff';\r\n        element.style.color = '#000';\r\n        element.style.padding = '1.5em';\r\n        element.style.width = '400px';\r\n        element.style.margin = '5em auto 0';\r\n\r\n        if ( contexts[ version ] ) {\r\n            message = message.replace( '$0', 'graphics card' );\r\n        } else {\r\n            message = message.replace( '$0', 'browser' );\r\n        }\r\n        message = message.replace( '$1', names[ version ] );\r\n        element.innerHTML = message;\r\n\r\n        return element;\r\n    }\r\n\r\n};\r\n","import _slicedToArray from \"C:\\\\personal\\\\three.quarks-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"C:\\\\personal\\\\three.quarks-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\personal\\\\three.quarks-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\personal\\\\three.quarks-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\personal\\\\three.quarks-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\personal\\\\three.quarks-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\n\n/**\n * three.quarks v0.2.4 build Sun Oct 04 2020\n * https://github.com/Alchemist0823/three.quarks#readme\n * Copyright 2020 undefined, MIT\n */\nimport { Mesh, InstancedBufferGeometry, InterleavedBuffer, InterleavedBufferAttribute, InstancedBufferAttribute, DynamicDrawUsage, Uniform, Matrix3, Vector2, ShaderMaterial, AdditiveBlending, DoubleSide, FrontSide, Vector4, Vector3, MathUtils, DefaultLoadingManager, LoaderUtils, FileLoader, LoadingManager, ImageLoader, CubeTexture, Texture, Object3D, Group, UVMapping, CubeReflectionMapping, CubeRefractionMapping, EquirectangularReflectionMapping, EquirectangularRefractionMapping, CubeUVReflectionMapping, CubeUVRefractionMapping, RepeatWrapping, ClampToEdgeWrapping, MirroredRepeatWrapping, NearestFilter, NearestMipMapNearestFilter, NearestMipMapLinearFilter, LinearFilter, LinearMipMapNearestFilter, LinearMipMapLinearFilter } from 'three';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar particle_frag =\n/* glsl */\n\"\\n\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\n\\nvarying vec4 vColor;\\n\\nvoid main() {\\n\\n    #include <clipping_planes_fragment>\\n    \\n    vec3 outgoingLight = vec3( 0.0 );\\n    vec4 diffuseColor = vColor;\\n    \\n    #include <logdepthbuf_fragment>\\n    \\n    #ifdef USE_MAP\\n    vec4 texelColor = texture2D( map, vUv);\\n    diffuseColor *= texelColor;\\n    #endif\\n\\n    outgoingLight = diffuseColor.rgb;\\n\\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n    \\n    #include <tonemapping_fragment>\\n\\n}\\n\";\n/*\r\n    gl_FragColor = vec4(vUv.x, vUv.y, 1.0, 1.0);\r\n\r\n    #ifdef USE_MAP\r\n    vec4 texelColor = texture2D( map, vUv);\r\n    diffuseColor *= texelColor;\r\n    #endif\r\n\r\n    outgoingLight = diffuseColor.rgb;\r\n\r\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n*/\n\nvar particle_vert =\n/* glsl */\n\"\\n\\n#include <uv_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n\\nattribute vec3 offset;\\nattribute float rotation;\\nattribute float size;\\nattribute vec4 color;\\nattribute float uvTile;\\n\\nvarying vec4 vColor;\\n\\n#ifdef UV_TILE\\nuniform vec2 tileCount;\\n#endif\\n\\nvoid main() {\\n\\n    #ifdef UV_TILE\\n        vUv = vec2((mod(uvTile, tileCount.y) + uv.x) * (1.0 / tileCount.x), ((tileCount.y - floor(uvTile / tileCount.y) - 1.0) + uv.y) * (1.0 / tileCount.y));\\n    #else\\n        #include <uv_vertex>\\n    #endif\\n\\t\\n\\t#ifdef WORLD_SPACE\\n\\t    vec4 mvPosition = viewMatrix * vec4( offset, 1.0 );\\n\\t#else\\n\\t    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\\n\\t#endif\\n\\t\\n    vec2 alignedPosition = ( position.xy ) * size;\\n    \\n    vec2 rotatedPosition;\\n    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\n    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\n    \\n    mvPosition.xy += rotatedPosition;\\n\\n\\tvColor = color;\\n\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n}\\n\";\n/*\r\n\t#ifndef USE_SIZEATTENUATION\r\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\r\n\t\tif ( isPerspective ) computedSize *= - mvPosition.z;\r\n\t#endif\r\n */\n\nvar local_particle_vert =\n/* glsl */\n\"\\n\\n#include <uv_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n\\nattribute vec3 offset;\\nattribute float rotation;\\nattribute float size;\\nattribute vec4 color;\\nattribute float uvTile;\\n\\nvarying vec4 vColor;\\n\\n#ifdef UV_TILE\\nuniform vec2 tileCount;\\n#endif\\n\\nvoid main() {\\n\\n    #ifdef UV_TILE\\n        vUv = vec2((mod(uvTile, tileCount.y) + uv.x) * (1.0 / tileCount.x), ((tileCount.y - floor(uvTile / tileCount.y) - 1.0) + uv.y) * (1.0 / tileCount.y));\\n    #else\\n        #include <uv_vertex>\\n    #endif\\n\\t\\n    vec2 alignedPosition = ( position.xy ) * size;\\n    \\n    vec2 rotatedPosition;\\n    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\n    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\n    \\n\\t#ifdef WORLD_SPACE\\n\\t    vec4 mvPosition = viewMatrix * vec4( offset + vec3(rotatedPosition, 0.0), 1.0 );\\n\\t#else\\n\\t    vec4 mvPosition = modelViewMatrix * vec4( offset + vec3(rotatedPosition, 0.0), 1.0 );\\n\\t#endif\\n\\n\\tvColor = color;\\n\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n}\\n\";\nvar stretched_bb_particle_vert =\n/* glsl */\n\"\\n\\n#include <uv_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\n\\nattribute vec3 offset;\\nattribute float rotation;\\nattribute float size;\\nattribute vec4 color;\\nattribute vec3 velocity;\\nattribute float uvTile;\\n\\nvarying vec4 vColor;\\n\\n#ifdef UV_TILE\\nuniform vec2 tileCount;\\n#endif\\n\\nuniform float speedFactor;\\n\\nvoid main() {\\n\\n    #ifdef UV_TILE\\n        vUv = vec2((mod(uvTile, tileCount.y) + uv.x) * (1.0 / tileCount.x), ((tileCount.y - floor(uvTile / tileCount.y) - 1.0) + uv.y) * (1.0 / tileCount.y));\\n    #else\\n        #include <uv_vertex>\\n    #endif\\n\\t\\n\\t#ifdef WORLD_SPACE\\n\\t    vec4 mvPosition = viewMatrix * vec4( offset, 1.0 );\\n        vec3 viewVelocity = vec3(viewMatrix * vec4(velocity, 1.0));\\n\\t#else\\n\\t    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\\n        vec3 viewVelocity = vec3(modelViewMatrix * vec4(velocity, 1.0));\\n\\t#endif\\n\\n    vec3 scaledPos = vec3(position.xy * size, position.z);\\n    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;\\n\\n\\tvColor = color;\\n\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\n}\\n\";\n/*\r\n\r\n    vec3 instancePos = vec3(position.xy * size, position.z);\r\n    instancePos += dot(instancePos, viewVelocity) * viewVelocity * speedFactor;\r\n    mvPosition.xyz += instancePos;\r\n\r\n\tvColor = color; //vec4(1, 1, 1, 1); //color; //length(viewVelocity) * 0.1\r\n\r\n\t#ifndef USE_SIZEATTENUATION\r\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\r\n\t\tif ( isPerspective ) computedSize *= - mvPosition.z;\r\n\t#endif\r\n */\n\nvar RenderMode;\n\n(function (RenderMode) {\n  RenderMode[RenderMode[\"BillBoard\"] = 0] = \"BillBoard\";\n  RenderMode[RenderMode[\"StretchedBillBoard\"] = 1] = \"StretchedBillBoard\";\n  RenderMode[RenderMode[\"LocalSpaceBillBoard\"] = 2] = \"LocalSpaceBillBoard\";\n})(RenderMode || (RenderMode = {}));\n\nvar ParticleEmitter = /*#__PURE__*/function (_Mesh) {\n  _inherits(ParticleEmitter, _Mesh);\n\n  var _super = _createSuper(ParticleEmitter);\n\n  function ParticleEmitter(system, parameters) {\n    var _this;\n\n    _classCallCheck(this, ParticleEmitter);\n\n    _this = _super.call(this);\n\n    _defineProperty(_assertThisInitialized(_this), \"type\", \"ParticleEmitter\");\n\n    _defineProperty(_assertThisInitialized(_this), \"system\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"geometry\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"material\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"interleavedBuffer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"rotationBuffer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"sizeBuffer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"colorBuffer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"offsetBuffer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"velocityBuffer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"tiling\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"uvTileBuffer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"renderMode\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"speedFactor\", void 0);\n\n    _this.system = system;\n    _this.geometry = new InstancedBufferGeometry();\n    _this.renderMode = parameters.renderMode || RenderMode.BillBoard;\n    _this.speedFactor = parameters.speedFactor || 1;\n    var instancingGeometry = new Float32Array(parameters.instancingGeometry || [-0.5, -0.5, 0, 0, 0, 0.5, -0.5, 0, 1, 0, 0.5, 0.5, 0, 1, 1, -0.5, 0.5, 0, 0, 1]);\n    var uniforms = {};\n    var defines = {};\n    _this.interleavedBuffer = new InterleavedBuffer(instancingGeometry, 5);\n\n    _this.geometry.setIndex([0, 1, 2, 0, 2, 3]);\n\n    _this.geometry.setAttribute('position', new InterleavedBufferAttribute(_this.interleavedBuffer, 3, 0, false));\n\n    _this.geometry.setAttribute('uv', new InterleavedBufferAttribute(_this.interleavedBuffer, 2, 3, false));\n\n    _this.offsetBuffer = new InstancedBufferAttribute(new Float32Array(system.maxParticle * 3), 3);\n\n    _this.offsetBuffer.setUsage(DynamicDrawUsage);\n\n    _this.geometry.setAttribute('offset', _this.offsetBuffer);\n\n    _this.colorBuffer = new InstancedBufferAttribute(new Float32Array(system.maxParticle * 4), 4);\n\n    _this.offsetBuffer.setUsage(DynamicDrawUsage);\n\n    _this.geometry.setAttribute('color', _this.colorBuffer);\n\n    _this.rotationBuffer = new InstancedBufferAttribute(new Float32Array(system.maxParticle), 1);\n\n    _this.offsetBuffer.setUsage(DynamicDrawUsage);\n\n    _this.geometry.setAttribute('rotation', _this.rotationBuffer);\n\n    _this.sizeBuffer = new InstancedBufferAttribute(new Float32Array(system.maxParticle), 1);\n\n    _this.offsetBuffer.setUsage(DynamicDrawUsage);\n\n    _this.geometry.setAttribute('size', _this.sizeBuffer);\n\n    _this.tiling = true;\n\n    if (parameters.texture) {\n      defines['USE_MAP'] = '';\n      defines['USE_UV'] = '';\n      uniforms['map'] = new Uniform(parameters.texture); //@ts-ignore\n\n      uniforms['uvTransform'] = new Uniform(new Matrix3().copy(parameters.texture.matrix));\n      var uTileCount = parameters.uTileCount || 1;\n      var vTileCount = parameters.vTileCount || 1; //this.tiling = uTileCount > 1 || vTileCount > 1;\n\n      _this.system.tileCount = uTileCount * vTileCount;\n\n      if (_this.tiling) {\n        _this.uvTileBuffer = new InstancedBufferAttribute(new Float32Array(system.maxParticle), 1);\n\n        _this.uvTileBuffer.setUsage(DynamicDrawUsage);\n\n        _this.geometry.setAttribute('uvTile', _this.uvTileBuffer);\n\n        defines['UV_TILE'] = '';\n        uniforms['tileCount'] = new Uniform(new Vector2(uTileCount, vTileCount));\n      }\n    }\n\n    if (parameters.worldSpace !== undefined ? parameters.worldSpace : true) {\n      defines['WORLD_SPACE'] = '';\n    }\n\n    if (_this.renderMode === RenderMode.BillBoard || _this.renderMode === RenderMode.LocalSpaceBillBoard) {\n      var vertexShader;\n      var side;\n\n      if (_this.renderMode === RenderMode.LocalSpaceBillBoard) {\n        vertexShader = local_particle_vert;\n        side = DoubleSide;\n      } else {\n        vertexShader = particle_vert;\n        side = FrontSide;\n      }\n\n      _this.material = new ShaderMaterial({\n        uniforms: uniforms,\n        defines: defines,\n        vertexShader: vertexShader,\n        fragmentShader: particle_frag,\n        transparent: true,\n        depthWrite: false,\n        blending: parameters.blending || AdditiveBlending,\n        side: side\n      });\n    } else if (_this.renderMode === RenderMode.StretchedBillBoard) {\n      _this.velocityBuffer = new InstancedBufferAttribute(new Float32Array(system.maxParticle * 3), 3);\n\n      _this.velocityBuffer.setUsage(DynamicDrawUsage);\n\n      _this.geometry.setAttribute('velocity', _this.velocityBuffer);\n\n      uniforms['speedFactor'] = new Uniform(parameters.speedFactor);\n      _this.material = new ShaderMaterial({\n        uniforms: uniforms,\n        defines: defines,\n        vertexShader: stretched_bb_particle_vert,\n        fragmentShader: particle_frag,\n        transparent: true,\n        depthWrite: false,\n        blending: parameters.blending || AdditiveBlending\n      });\n    } else {\n      throw new Error(\"render mode unavailable\");\n    } // TODO: implement boundingVolume\n\n\n    _this.frustumCulled = false;\n    return _this;\n  }\n\n  _createClass(ParticleEmitter, [{\n    key: \"update\",\n    value: function update() {\n      var particles = this.system.particles;\n      var particleNum = this.system.particleNum;\n      this.geometry.instanceCount = particleNum;\n\n      for (var i = 0; i < particleNum; i++) {\n        var particle = particles[i];\n        this.offsetBuffer.setXYZ(i, particle.position.x, particle.position.y, particle.position.z);\n        this.colorBuffer.setXYZW(i, particle.color.x, particle.color.y, particle.color.z, particle.color.w);\n        this.rotationBuffer.setX(i, particle.rotation);\n        this.sizeBuffer.setX(i, particle.size);\n\n        if (this.renderMode === RenderMode.StretchedBillBoard) {\n          this.velocityBuffer.setXYZ(i, particle.velocity.x, particle.velocity.y, particle.velocity.z);\n        }\n\n        if (this.tiling) {\n          this.uvTileBuffer.setX(i, particle.uvTile);\n        }\n      }\n\n      if (particleNum > 0) {\n        this.offsetBuffer.updateRange.count = particleNum * 3;\n        this.offsetBuffer.needsUpdate = true;\n        this.colorBuffer.updateRange.count = particleNum * 4;\n        this.colorBuffer.needsUpdate = true;\n        this.rotationBuffer.updateRange.count = particleNum;\n        this.rotationBuffer.needsUpdate = true;\n        this.sizeBuffer.updateRange.count = particleNum;\n        this.sizeBuffer.needsUpdate = true;\n\n        if (this.renderMode === RenderMode.StretchedBillBoard) {\n          this.velocityBuffer.updateRange.count = particleNum * 3;\n          this.velocityBuffer.needsUpdate = true;\n        }\n\n        if (this.tiling) {\n          this.uvTileBuffer.updateRange.count = particleNum;\n          this.uvTileBuffer.needsUpdate = true;\n        }\n      }\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.geometry.dispose();\n    } // extract data from the cache hash\n    // remove metadata on each item\n    // and return as array\n\n  }, {\n    key: \"extractFromCache\",\n    value: function extractFromCache(cache) {\n      var values = [];\n\n      for (var key in cache) {\n        var data = cache[key];\n        delete data.metadata;\n        values.push(data);\n      }\n\n      return values;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON(meta) {\n      // meta is a string when called from JSON.stringify\n      var isRootObject = meta === undefined || typeof meta === 'string';\n      var output = {}; // meta is a hash used to collect geometries, materials.\n      // not providing it implies that this is the root object\n      // being serialized.\n\n      if (isRootObject) {\n        // initialize meta obj\n        meta = {\n          geometries: {},\n          materials: {},\n          textures: {},\n          images: {},\n          shapes: {}\n        };\n        output.metadata = {\n          version: 4.5,\n          type: 'Object',\n          generator: 'Object3D.toJSON'\n        };\n      } // standard Object3D serialization\n\n\n      var object = {};\n      object.uuid = this.uuid;\n      object.type = this.type;\n      if (this.name !== '') object.name = this.name;\n      if (this.castShadow === true) object.castShadow = true;\n      if (this.receiveShadow === true) object.receiveShadow = true;\n      if (this.visible === false) object.visible = false;\n      if (this.frustumCulled === false) object.frustumCulled = false;\n      if (this.renderOrder !== 0) object.renderOrder = this.renderOrder;\n      if (JSON.stringify(this.userData) !== '{}') object.userData = this.userData;\n      object.layers = this.layers.mask;\n      object.matrix = this.matrix.toArray();\n      if (this.matrixAutoUpdate === false) object.matrixAutoUpdate = false; // object specific properties\n\n      if (this.system !== null) object.ps = this.system.toJSON(meta);\n\n      if (this.children.length > 0) {\n        object.children = [];\n\n        for (var i = 0; i < this.children.length; i++) {\n          object.children.push(this.children[i].toJSON(meta).object);\n        }\n      }\n\n      if (isRootObject) {\n        var geometries = this.extractFromCache(meta.geometries);\n        var materials = this.extractFromCache(meta.materials);\n        var textures = this.extractFromCache(meta.textures);\n        var images = this.extractFromCache(meta.images);\n        if (geometries.length > 0) output.geometries = geometries;\n        if (materials.length > 0) output.materials = materials;\n        if (textures.length > 0) output.textures = textures;\n        if (images.length > 0) output.images = images;\n      }\n\n      output.object = object;\n      return output;\n    }\n  }]);\n\n  return ParticleEmitter;\n}(Mesh);\n\nvar Particle = function Particle() {\n  _classCallCheck(this, Particle);\n\n  _defineProperty(this, \"startSpeed\", 0);\n\n  _defineProperty(this, \"startColor\", new Vector4());\n\n  _defineProperty(this, \"startSize\", 1);\n\n  _defineProperty(this, \"velocity\", new Vector3());\n\n  _defineProperty(this, \"age\", 0);\n\n  _defineProperty(this, \"life\", 1);\n\n  _defineProperty(this, \"angularVelocity\", void 0);\n\n  _defineProperty(this, \"position\", new Vector3());\n\n  _defineProperty(this, \"rotation\", 0);\n\n  _defineProperty(this, \"size\", 1);\n\n  _defineProperty(this, \"color\", new Vector4());\n\n  _defineProperty(this, \"uvTile\", 0);\n};\n\nvar ConstantValue = /*#__PURE__*/function () {\n  function ConstantValue(value) {\n    _classCallCheck(this, ConstantValue);\n\n    this.value = value;\n\n    _defineProperty(this, \"type\", void 0);\n\n    this.type = 'value';\n  }\n\n  _createClass(ConstantValue, [{\n    key: \"genValue\",\n    value: function genValue() {\n      return this.value;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"ConstantValue\",\n        value: this.value\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new ConstantValue(json.value);\n    }\n  }]);\n\n  return ConstantValue;\n}();\n\nvar IntervalValue = /*#__PURE__*/function () {\n  function IntervalValue(a, b) {\n    _classCallCheck(this, IntervalValue);\n\n    this.a = a;\n    this.b = b;\n\n    _defineProperty(this, \"type\", void 0);\n\n    this.type = \"value\";\n  }\n\n  _createClass(IntervalValue, [{\n    key: \"genValue\",\n    value: function genValue() {\n      return MathUtils.lerp(this.a, this.b, Math.random());\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"IntervalValue\",\n        a: this.a,\n        b: this.b\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new IntervalValue(json.a, json.b);\n    }\n  }]);\n\n  return IntervalValue;\n}();\n\nvar PiecewiseFunction = /*#__PURE__*/function () {\n  function PiecewiseFunction() {\n    _classCallCheck(this, PiecewiseFunction);\n\n    _defineProperty(this, \"functions\", void 0);\n\n    this.functions = new Array();\n  }\n\n  _createClass(PiecewiseFunction, [{\n    key: \"findFunction\",\n    value: function findFunction(t) {\n      var mid = 0;\n      var left = 0,\n          right = this.functions.length - 1;\n\n      while (left + 1 < right) {\n        mid = (left + right) / 2;\n        if (t < this.getStartX(mid)) right = mid - 1;else if (t > this.getEndX(mid)) left = mid + 1;else return mid;\n      }\n\n      for (var i = left; i <= right; i++) {\n        if (t >= this.functions[i][1] && t <= this.getEndX(i)) return i;\n      }\n\n      return -1;\n    }\n  }, {\n    key: \"getStartX\",\n    value: function getStartX(index) {\n      return this.functions[index][1];\n    }\n  }, {\n    key: \"setStartX\",\n    value: function setStartX(index, x) {\n      if (index > 0) this.functions[index][1] = x;\n    }\n  }, {\n    key: \"getEndX\",\n    value: function getEndX(index) {\n      if (index + 1 < this.functions.length) return this.functions[index + 1][1];\n      return 1;\n    }\n  }, {\n    key: \"setEndX\",\n    value: function setEndX(index, x) {\n      if (index + 1 < this.functions.length) this.functions[index + 1][1] = x;\n    }\n  }, {\n    key: \"getFunction\",\n    value: function getFunction(index) {\n      return this.functions[index][0];\n    }\n  }, {\n    key: \"setFunction\",\n    value: function setFunction(index, func) {\n      this.functions[index][0] = func;\n    }\n  }, {\n    key: \"numOfFunctions\",\n    get: function get() {\n      return this.functions.length;\n    }\n  }]);\n\n  return PiecewiseFunction;\n}();\n\nvar Bezier = /*#__PURE__*/function () {\n  function Bezier(p1, p2, p3, p4) {\n    _classCallCheck(this, Bezier);\n\n    _defineProperty(this, \"p\", void 0);\n\n    this.p = [p1, p2, p3, p4];\n  }\n\n  _createClass(Bezier, [{\n    key: \"genValue\",\n    value: function genValue(t) {\n      var t2 = t * t;\n      var t3 = t * t * t;\n      var mt = 1 - t;\n      var mt2 = mt * mt;\n      var mt3 = mt2 * mt;\n      return this.p[0] * mt3 + this.p[1] * mt2 * t * 3 + this.p[2] * mt * t2 * 3 + this.p[3] * t3;\n    } // get the coefficients of the polynomial's derivatives\n\n  }, {\n    key: \"derivativeCoefficients\",\n    value: function derivativeCoefficients(points) {\n      var dpoints = [];\n\n      for (var p = points, c = p.length - 1; c > 0; c--) {\n        var list = [];\n\n        for (var j = 0; j < c; j++) {\n          var dpt = c * (p[j + 1] - p[j]);\n          list.push(dpt);\n        }\n\n        dpoints.push(list);\n        p = list;\n      }\n\n      return dpoints;\n    } // calculate the slope\n\n  }, {\n    key: \"getSlope\",\n    value: function getSlope(t) {\n      var p = this.derivativeCoefficients(this.p)[0];\n      var mt = 1 - t;\n      var a = mt * mt;\n      var b = mt * t * 2;\n      var c = t * t;\n      return a * p[0] + b * p[1] + c * p[2]; //return  a * (p[1] - p[0]) * 3 + b * (p[2] - p[1]) * 3 + c * (p[3] - p[2]) * 3;\n    } // derivative(0) = (p[1] - p[0]) * 3\n    // derivative(1) = (p[3] - p[2]) * 3\n\n  }, {\n    key: \"controlCurve\",\n    value: function controlCurve(d0, d1) {\n      this.p[1] = d0 / 3 + this.p[0];\n      this.p[2] = this.p[3] - d1 / 3;\n    }\n  }, {\n    key: \"hull\",\n    value: function hull(t) {\n      var p = this.p;\n      var _p = [],\n          pt,\n          q = [],\n          idx = 0,\n          i = 0,\n          l = 0;\n      q[idx++] = p[0];\n      q[idx++] = p[1];\n      q[idx++] = p[2];\n      q[idx++] = p[3]; // we lerp between all points at each iteration, until we have 1 point left.\n\n      while (p.length > 1) {\n        _p = [];\n\n        for (i = 0, l = p.length - 1; i < l; i++) {\n          pt = t * p[i] + (1 - t) * p[i + 1];\n          q[idx++] = pt;\n\n          _p.push(pt);\n        }\n\n        p = _p;\n      }\n\n      return q;\n    }\n  }, {\n    key: \"split\",\n    value: function split(t) {\n      // no shortcut: use \"de Casteljau\" iteration.\n      var q = this.hull(t);\n      var result = {\n        left: new Bezier(q[0], q[4], q[7], q[9]),\n        right: new Bezier(q[9], q[8], q[6], q[3]),\n        span: q\n      };\n      return result;\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      return new Bezier(this.p[0], this.p[1], this.p[2], this.p[3]);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        p0: this.p[0],\n        p1: this.p[1],\n        p2: this.p[2],\n        p3: this.p[3]\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new Bezier(json.p0, json.p1, json.p2, json.p3);\n    }\n  }]);\n\n  return Bezier;\n}();\n\nvar PiecewiseBezier = /*#__PURE__*/function (_PiecewiseFunction) {\n  _inherits(PiecewiseBezier, _PiecewiseFunction);\n\n  var _super2 = _createSuper(PiecewiseBezier);\n\n  // default linear bezier\n  function PiecewiseBezier() {\n    var _this2;\n\n    var curves = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [[new Bezier(0, 1.0 / 3, 1.0 / 3 * 2, 1), 0]];\n\n    _classCallCheck(this, PiecewiseBezier);\n\n    _this2 = _super2.call(this);\n\n    _defineProperty(_assertThisInitialized(_this2), \"type\", void 0);\n\n    _this2.type = \"function\";\n    _this2.functions = curves;\n    return _this2;\n  }\n\n  _createClass(PiecewiseBezier, [{\n    key: \"genValue\",\n    value: function genValue() {\n      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var index = this.findFunction(t);\n\n      if (index === -1) {\n        console.error(t);\n        return 0;\n      }\n\n      return this.functions[index][0].genValue((t - this.getStartX(index)) / (this.getEndX(index) - this.getStartX(index)));\n    }\n  }, {\n    key: \"toSVG\",\n    value: function toSVG(length, segments) {\n      if (segments < 1) return \"\";\n      var result = [\"M\", 0, this.functions[0][0].p[0]].join(\" \");\n\n      for (var i = 1.0 / segments; i <= 1; i += 1.0 / segments) {\n        result = [result, \"L\", i * length, this.genValue(i)].join(\" \");\n      }\n\n      return result;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"PiecewiseBezier\",\n        functions: this.functions.map(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              bezier = _ref2[0],\n              start = _ref2[1];\n\n          return {\n            function: bezier.toJSON(),\n            start: start\n          };\n        })\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new PiecewiseBezier(json.functions.map(function (piecewiseFunction) {\n        return [Bezier.fromJSON(piecewiseFunction.function), piecewiseFunction.start];\n      }));\n    }\n  }]);\n\n  return PiecewiseBezier;\n}(PiecewiseFunction);\n\nfunction ValueGeneratorFromJSON(json) {\n  switch (json.type) {\n    case 'ConstantValue':\n      return ConstantValue.fromJSON(json);\n\n    case 'IntervalValue':\n      return IntervalValue.fromJSON(json);\n\n    case 'PiecewiseBezier':\n      return PiecewiseBezier.fromJSON(json);\n\n    default:\n      return new ConstantValue(0);\n  }\n}\n\nvar ColorToJSON = function ColorToJSON(color) {\n  return {\n    r: color.x,\n    g: color.y,\n    b: color.z,\n    a: color.w\n  };\n};\n\nvar JSONToColor = function JSONToColor(json) {\n  return new Vector4(json.r, json.g, json.b, json.a);\n};\n\nvar RandomColor = /*#__PURE__*/function () {\n  function RandomColor(a, b) {\n    _classCallCheck(this, RandomColor);\n\n    this.a = a;\n    this.b = b;\n\n    _defineProperty(this, \"type\", void 0);\n\n    this.type = \"value\";\n  }\n\n  _createClass(RandomColor, [{\n    key: \"genColor\",\n    value: function genColor(color) {\n      var rand = Math.random();\n      return color.copy(this.a).lerp(this.b, rand);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"RandomColor\",\n        a: ColorToJSON(this.a),\n        b: ColorToJSON(this.b)\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new RandomColor(JSONToColor(json.a), JSONToColor(json.b));\n    }\n  }]);\n\n  return RandomColor;\n}();\n\nvar ColorRange = /*#__PURE__*/function () {\n  function ColorRange(a, b) {\n    _classCallCheck(this, ColorRange);\n\n    this.a = a;\n    this.b = b;\n\n    _defineProperty(this, \"type\", void 0);\n\n    this.type = \"function\";\n  }\n\n  _createClass(ColorRange, [{\n    key: \"genColor\",\n    value: function genColor(color, t) {\n      return color.copy(this.a).lerp(this.b, t);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"ColorRange\",\n        a: ColorToJSON(this.a),\n        b: ColorToJSON(this.b)\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new ColorRange(JSONToColor(json.a), JSONToColor(json.b));\n    }\n  }]);\n\n  return ColorRange;\n}();\n\nvar ConstantColor = /*#__PURE__*/function () {\n  function ConstantColor(color) {\n    _classCallCheck(this, ConstantColor);\n\n    this.color = color;\n\n    _defineProperty(this, \"type\", void 0);\n\n    this.type = 'value';\n  }\n\n  _createClass(ConstantColor, [{\n    key: \"genColor\",\n    value: function genColor(color) {\n      return color.copy(this.color);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"ConstantColor\",\n        color: ColorToJSON(this.color)\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new ConstantColor(JSONToColor(json.color));\n    }\n  }]);\n\n  return ConstantColor;\n}();\n\nfunction ColorGeneratorFromJSON(json) {\n  switch (json.type) {\n    case 'ConstantColor':\n      return ConstantColor.fromJSON(json);\n\n    case 'ColorRange':\n      return ColorRange.fromJSON(json);\n\n    case 'RandomColor':\n      return RandomColor.fromJSON(json);\n\n    default:\n      return new ConstantColor(new Vector4(1, 1, 1, 1));\n  }\n}\n\nvar ColorOverLife = /*#__PURE__*/function () {\n  function ColorOverLife(func) {\n    _classCallCheck(this, ColorOverLife);\n\n    this.func = func;\n\n    _defineProperty(this, \"type\", 'ColorOverLife');\n  }\n\n  _createClass(ColorOverLife, [{\n    key: \"initialize\",\n    value: function initialize(particle) {}\n  }, {\n    key: \"update\",\n    value: function update(particle, delta) {\n      this.func.genColor(particle.color, particle.age / particle.life).dot(particle.startColor);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: this.type,\n        func: this.func.toJSON()\n      };\n    }\n  }]);\n\n  return ColorOverLife;\n}();\n\nvar RotationOverLife = /*#__PURE__*/function () {\n  function RotationOverLife(angularVelocityFunc) {\n    _classCallCheck(this, RotationOverLife);\n\n    this.angularVelocityFunc = angularVelocityFunc;\n\n    _defineProperty(this, \"type\", 'RotationOverLife');\n  }\n\n  _createClass(RotationOverLife, [{\n    key: \"initialize\",\n    value: function initialize(particle) {\n      if (this.angularVelocityFunc.type === 'value') {\n        particle.angularVelocity = this.angularVelocityFunc.genValue();\n      } else {\n        particle.angularVelocity = 0;\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update(particle, delta) {\n      if (this.angularVelocityFunc.type === 'value') {\n        particle.rotation += delta * particle.angularVelocity;\n      } else {\n        particle.rotation += delta * this.angularVelocityFunc.genValue(particle.age / particle.life);\n      }\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: this.type,\n        func: this.angularVelocityFunc.toJSON()\n      };\n    }\n  }]);\n\n  return RotationOverLife;\n}();\n\nvar SizeOverLife = /*#__PURE__*/function () {\n  _createClass(SizeOverLife, [{\n    key: \"initialize\",\n    value: function initialize(particle) {}\n  }]);\n\n  function SizeOverLife(func) {\n    _classCallCheck(this, SizeOverLife);\n\n    this.func = func;\n\n    _defineProperty(this, \"type\", 'SizeOverLife');\n  }\n\n  _createClass(SizeOverLife, [{\n    key: \"update\",\n    value: function update(particle) {\n      particle.size = particle.startSize * this.func.genValue(particle.age / particle.life);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: this.type,\n        func: this.func.toJSON()\n      };\n    }\n  }]);\n\n  return SizeOverLife;\n}();\n\nvar FrameOverLife = /*#__PURE__*/function () {\n  function FrameOverLife(func) {\n    _classCallCheck(this, FrameOverLife);\n\n    this.func = func;\n\n    _defineProperty(this, \"type\", 'FrameOverLife');\n  }\n\n  _createClass(FrameOverLife, [{\n    key: \"initialize\",\n    value: function initialize(particle) {}\n  }, {\n    key: \"update\",\n    value: function update(particle, delta) {\n      particle.uvTile = Math.floor(this.func.genValue(particle.age / particle.life));\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: this.type,\n        func: this.func.toJSON()\n      };\n    }\n  }]);\n\n  return FrameOverLife;\n}();\n\nfunction BehaviorFromJSON(json) {\n  switch (json.type) {\n    case 'ColorOverLife':\n      return new ColorOverLife(ColorGeneratorFromJSON(json.func));\n\n    case 'RotationOverLife':\n      return new RotationOverLife(ValueGeneratorFromJSON(json.func));\n\n    case 'SizeOverLife':\n      return new SizeOverLife(ValueGeneratorFromJSON(json.func));\n\n    case 'FrameOverLife':\n      return new FrameOverLife(ValueGeneratorFromJSON(json.func));\n\n    default:\n      return new ColorOverLife(new ColorRange(new Vector4(1, 1, 1, 1), new Vector4(1, 1, 1, 1)));\n  }\n}\n\nvar ConeEmitter = /*#__PURE__*/function () {\n  // [0, Math.PI * 2]\n  // [0, Math.PI / 2]\n  function ConeEmitter() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ConeEmitter);\n\n    _defineProperty(this, \"radius\", void 0);\n\n    _defineProperty(this, \"arc\", void 0);\n\n    _defineProperty(this, \"thickness\", void 0);\n\n    _defineProperty(this, \"angle\", void 0);\n\n    this.radius = parameters.radius || 10;\n    this.arc = parameters.arc || 2.0 * Math.PI;\n    this.thickness = parameters.thickness || 1;\n    this.angle = parameters.angle || Math.PI / 6;\n  }\n\n  _createClass(ConeEmitter, [{\n    key: \"initialize\",\n    value: function initialize(p) {\n      var u = Math.random();\n      var rand = MathUtils.lerp(1 - this.thickness, 1, Math.random());\n      var theta = u * this.arc;\n      var r = Math.sqrt(rand);\n      var sinTheta = Math.sin(theta);\n      var cosTheta = Math.cos(theta);\n      p.position.x = r * cosTheta;\n      p.position.y = r * sinTheta;\n      p.position.z = 0;\n      var angle = this.angle * r;\n      p.velocity.set(0, 0, Math.cos(angle)).addScaledVector(p.position, Math.sin(angle)).multiplyScalar(p.startSpeed); //const v = Math.random();\n\n      p.position.multiplyScalar(this.radius);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"cone\",\n        radius: this.radius,\n        arc: this.arc,\n        thickness: this.thickness,\n        angle: this.angle\n      };\n    }\n  }]);\n\n  return ConeEmitter;\n}();\n\nvar SphereEmitter = /*#__PURE__*/function () {\n  //[0, 1]\n  function SphereEmitter() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, SphereEmitter);\n\n    _defineProperty(this, \"radius\", void 0);\n\n    _defineProperty(this, \"arc\", void 0);\n\n    _defineProperty(this, \"thickness\", void 0);\n\n    this.radius = parameters.radius || 10;\n    this.arc = parameters.arc || 2.0 * Math.PI;\n    this.thickness = parameters.thickness || 1;\n  }\n\n  _createClass(SphereEmitter, [{\n    key: \"initialize\",\n    value: function initialize(p) {\n      var u = Math.random();\n      var v = Math.random();\n      var rand = MathUtils.lerp(1 - this.thickness, 1, Math.random());\n      var theta = u * this.arc;\n      var phi = Math.acos(2.0 * v - 1.0);\n      var r = Math.cbrt(rand);\n      var sinTheta = Math.sin(theta);\n      var cosTheta = Math.cos(theta);\n      var sinPhi = Math.sin(phi);\n      var cosPhi = Math.cos(phi);\n      p.position.x = r * sinPhi * cosTheta;\n      p.position.y = r * sinPhi * sinTheta;\n      p.position.z = r * cosPhi;\n      p.velocity.setScalar(0).addScaledVector(p.position, p.startSpeed);\n      p.position.multiplyScalar(this.radius);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"sphere\",\n        radius: this.radius,\n        arc: this.arc,\n        thickness: this.thickness\n      };\n    }\n  }]);\n\n  return SphereEmitter;\n}();\n\nvar PointEmitter = /*#__PURE__*/function () {\n  function PointEmitter() {\n    _classCallCheck(this, PointEmitter);\n  }\n\n  _createClass(PointEmitter, [{\n    key: \"initialize\",\n    value: function initialize(p) {\n      var u = Math.random();\n      var v = Math.random();\n      var theta = u * Math.PI * 2;\n      var phi = Math.acos(2.0 * v - 1.0);\n      var r = Math.cbrt(Math.random());\n      var sinTheta = Math.sin(theta);\n      var cosTheta = Math.cos(theta);\n      var sinPhi = Math.sin(phi);\n      var cosPhi = Math.cos(phi);\n      p.velocity.x = r * sinPhi * cosTheta;\n      p.velocity.y = r * sinPhi * sinTheta;\n      p.velocity.z = r * cosPhi;\n      p.velocity.multiplyScalar(p.startSpeed);\n      p.position.setScalar(0);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: 'point'\n      };\n    }\n  }]);\n\n  return PointEmitter;\n}();\n\nvar DonutEmitter = /*#__PURE__*/function () {\n  // [0, Math.PI * 2]\n  // [0, Math.PI / 2]\n  function DonutEmitter() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, DonutEmitter);\n\n    _defineProperty(this, \"radius\", void 0);\n\n    _defineProperty(this, \"arc\", void 0);\n\n    _defineProperty(this, \"thickness\", void 0);\n\n    _defineProperty(this, \"angle\", void 0);\n\n    this.radius = parameters.radius || 10;\n    this.arc = parameters.arc || 2.0 * Math.PI;\n    this.thickness = parameters.thickness || 1;\n    this.angle = parameters.angle || Math.PI / 6;\n  }\n\n  _createClass(DonutEmitter, [{\n    key: \"initialize\",\n    value: function initialize(p) {\n      var u = Math.random();\n      var rand = MathUtils.lerp(this.thickness, 1, Math.random());\n      var theta = u * this.arc;\n      var r = Math.sqrt(rand);\n      var sinTheta = Math.sin(theta);\n      var cosTheta = Math.cos(theta);\n      p.position.x = r * cosTheta;\n      p.position.y = r * sinTheta;\n      p.position.z = 0;\n      var angle = this.angle * r;\n      p.velocity.set(0, 0, Math.cos(angle)).addScaledVector(p.position, Math.sin(angle)).multiplyScalar(p.startSpeed); //const v = Math.random();\n\n      p.position.multiplyScalar(this.radius);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"donut\",\n        radius: this.radius,\n        arc: this.arc,\n        thickness: this.thickness,\n        angle: this.angle\n      };\n    }\n  }]);\n\n  return DonutEmitter;\n}();\n\nvar ParticleSystem = /*#__PURE__*/function () {\n  _createClass(ParticleSystem, [{\n    key: \"texture\",\n    // parameters\n    // runtime data\n    get: function get() {\n      return this.emitter.material.uniforms.map.value;\n    },\n    set: function set(texture) {\n      this.emitter.material.uniforms.map.value = texture;\n    }\n  }, {\n    key: \"uTileCount\",\n    get: function get() {\n      return this.emitter.material.uniforms.tileCount.value.x;\n    },\n    set: function set(u) {\n      this.emitter.material.uniforms.tileCount.value.x = u;\n    }\n  }, {\n    key: \"vTileCount\",\n    get: function get() {\n      return this.emitter.material.uniforms.tileCount.value.y;\n    },\n    set: function set(v) {\n      this.emitter.material.uniforms.tileCount.value.y = v;\n    }\n  }, {\n    key: \"renderMode\",\n    get: function get() {\n      return this.emitter.renderMode;\n    }\n  }, {\n    key: \"speedFactor\",\n    get: function get() {\n      return this.emitter.material.uniforms.speedFactor.value;\n    },\n    set: function set(v) {\n      this.emitter.material.uniforms.speedFactor.value = v;\n    }\n  }, {\n    key: \"blending\",\n    get: function get() {\n      return this.emitter.material.blending;\n    },\n    set: function set(blending) {\n      this.emitter.material.blending = blending;\n    }\n  }]);\n\n  function ParticleSystem() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ParticleSystem);\n\n    _defineProperty(this, \"autoDestroy\", void 0);\n\n    _defineProperty(this, \"looping\", void 0);\n\n    _defineProperty(this, \"duration\", void 0);\n\n    _defineProperty(this, \"maxParticle\", void 0);\n\n    _defineProperty(this, \"startLife\", void 0);\n\n    _defineProperty(this, \"startSpeed\", void 0);\n\n    _defineProperty(this, \"startRotation\", void 0);\n\n    _defineProperty(this, \"startSize\", void 0);\n\n    _defineProperty(this, \"startColor\", void 0);\n\n    _defineProperty(this, \"startTileIndex\", void 0);\n\n    _defineProperty(this, \"emissionOverTime\", void 0);\n\n    _defineProperty(this, \"emissionOverDistance\", void 0);\n\n    _defineProperty(this, \"emissionBursts\", void 0);\n\n    _defineProperty(this, \"tileCount\", 1);\n\n    _defineProperty(this, \"worldSpace\", void 0);\n\n    _defineProperty(this, \"particleNum\", void 0);\n\n    _defineProperty(this, \"burstIndex\", void 0);\n\n    _defineProperty(this, \"burstWaveIndex\", void 0);\n\n    _defineProperty(this, \"time\", void 0);\n\n    _defineProperty(this, \"paused\", void 0);\n\n    _defineProperty(this, \"waitEmiting\", void 0);\n\n    _defineProperty(this, \"emitEnded\", void 0);\n\n    _defineProperty(this, \"markForDestroy\", void 0);\n\n    _defineProperty(this, \"behaviors\", void 0);\n\n    _defineProperty(this, \"particles\", void 0);\n\n    _defineProperty(this, \"emitterShape\", void 0);\n\n    _defineProperty(this, \"emitter\", void 0);\n\n    _defineProperty(this, \"normalMatrix\", new Matrix3());\n\n    this.autoDestroy = parameters.autoDestroy === undefined ? false : parameters.autoDestroy;\n    this.duration = parameters.duration || 1;\n    this.maxParticle = parameters.maxParticle || 100;\n    this.looping = parameters.looping === undefined ? true : parameters.looping;\n    this.startLife = parameters.startLife || new ConstantValue(5);\n    this.startSpeed = parameters.startSpeed || new ConstantValue(0);\n    this.startRotation = parameters.startRotation || new ConstantValue(0);\n    this.startSize = parameters.startSize || new ConstantValue(1);\n    this.startColor = parameters.startColor || new ConstantColor(new Vector4(1, 1, 1, 1));\n    this.emissionOverTime = parameters.emissionOverTime || new ConstantValue(10);\n    this.emissionOverDistance = parameters.emissionOverDistance || new ConstantValue(0);\n    this.emissionBursts = parameters.emissionBursts || [];\n    this.emitterShape = parameters.shape || new SphereEmitter();\n    this.behaviors = parameters.behaviors || new Array();\n    this.worldSpace = parameters.worldSpace === undefined ? false : parameters.worldSpace;\n    this.particles = new Array();\n    this.startTileIndex = parameters.startTileIndex || 0;\n    this.emitter = new ParticleEmitter(this, parameters);\n    this.particleNum = 0;\n    this.burstIndex = 0;\n    this.burstWaveIndex = 0;\n    this.time = 0;\n    this.paused = false;\n    this.waitEmiting = 0;\n    this.emitEnded = false;\n    this.markForDestroy = false;\n  }\n\n  _createClass(ParticleSystem, [{\n    key: \"pause\",\n    value: function pause() {\n      this.paused = true;\n    }\n  }, {\n    key: \"play\",\n    value: function play() {\n      this.paused = false;\n    }\n  }, {\n    key: \"spawn\",\n    value: function spawn() {\n      while (this.particleNum >= this.particles.length) {\n        this.particles.push(new Particle());\n      }\n\n      this.particleNum++;\n      var particle = this.particles[this.particleNum - 1];\n      this.startColor.genColor(particle.startColor, this.time);\n      particle.color.copy(particle.startColor);\n      particle.startSpeed = this.startSpeed.genValue(this.time);\n      particle.life = this.startLife.genValue(this.time);\n      particle.age = 0;\n      particle.rotation = this.startRotation.genValue(this.time);\n      particle.startSize = particle.size = this.startSize.genValue(this.time);\n      particle.uvTile = this.startTileIndex;\n      this.emitterShape.initialize(particle);\n\n      if (this.worldSpace) {\n        particle.position.applyMatrix4(this.emitter.matrixWorld);\n        particle.velocity.applyMatrix3(this.normalMatrix);\n      }\n\n      for (var j = 0; j < this.behaviors.length; j++) {\n        this.behaviors[j].initialize(particle);\n      }\n    }\n  }, {\n    key: \"endEmit\",\n    value: function endEmit() {\n      this.emitEnded = true;\n\n      if (this.autoDestroy) {\n        this.markForDestroy = true;\n      }\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.emitter.dispose();\n      if (this.emitter.parent) this.emitter.parent.remove(this.emitter);\n    }\n  }, {\n    key: \"restart\",\n    value: function restart() {\n      this.paused = false;\n      this.particleNum = 0;\n      this.burstIndex = 0;\n      this.burstWaveIndex = 0;\n      this.time = 0;\n      this.waitEmiting = 0;\n      this.emitEnded = false;\n      this.markForDestroy = false;\n    }\n  }, {\n    key: \"update\",\n    value: function update(delta) {\n      if (delta > 0.1) delta = 0.1;\n      if (this.paused) return;\n\n      if (this.emitEnded && this.particleNum === 0) {\n        if (this.markForDestroy && this.emitter.parent) this.dispose();\n        return;\n      }\n\n      if (this.time > this.duration) {\n        if (this.looping) {\n          this.time -= this.duration;\n        } else {\n          if (!this.emitEnded) {\n            this.endEmit();\n          }\n        }\n      }\n\n      this.normalMatrix.getNormalMatrix(this.emitter.matrixWorld); // particle die\n\n      for (var i = 0; i < this.particleNum; i++) {\n        var particle = this.particles[i];\n\n        if (particle.age >= particle.life) {\n          this.particles[i] = this.particles[this.particleNum - 1];\n          this.particles[this.particleNum - 1] = particle;\n          this.particleNum--;\n          i--;\n        }\n      } // spawn\n\n\n      while (this.waitEmiting > 0 && this.particleNum < this.maxParticle && !this.emitEnded) {\n        this.spawn();\n        this.waitEmiting--;\n      } // spawn burst\n\n\n      while (this.burstIndex < this.emissionBursts.length && this.emissionBursts[this.burstIndex].time <= this.time) {\n        if (Math.random() < this.emissionBursts[this.burstIndex].probability) {\n          var count = this.emissionBursts[this.burstIndex].count;\n\n          while (count > 0 && this.particleNum < this.maxParticle) {\n            this.spawn();\n            count--;\n          }\n        }\n\n        this.burstIndex++;\n      }\n\n      for (var _i = 0; _i < this.particleNum; _i++) {\n        var _particle = this.particles[_i];\n\n        for (var j = 0; j < this.behaviors.length; j++) {\n          this.behaviors[j].update(_particle, delta);\n        }\n\n        _particle.position.addScaledVector(_particle.velocity, delta);\n\n        _particle.age += delta;\n      }\n\n      this.emitter.update();\n\n      if (!this.emitEnded) {\n        this.waitEmiting += delta * this.emissionOverTime.genValue(this.time);\n      }\n\n      this.time += delta;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON(meta) {\n      this.texture.toJSON(meta);\n\n      if (this.texture.image !== undefined) {\n        var image = this.texture.image;\n        meta.images[image.uuid] = {\n          uuid: image.uuid,\n          url: this.texture.name\n        };\n      }\n\n      return {\n        autoDestroy: this.autoDestroy,\n        looping: this.looping,\n        duration: this.duration,\n        maxParticle: this.maxParticle,\n        shape: this.emitterShape.toJSON(),\n        startLife: this.startLife.toJSON(),\n        startSpeed: this.startSpeed.toJSON(),\n        startRotation: this.startRotation.toJSON(),\n        startSize: this.startSize.toJSON(),\n        startColor: this.startColor.toJSON(),\n        emissionOverTime: this.emissionOverTime.toJSON(),\n        emissionOverDistance: this.emissionOverDistance.toJSON(),\n        emissionBursts: this.emissionBursts,\n        instancingGeometry: Array.from(this.emitter.interleavedBuffer.array),\n        renderMode: this.renderMode,\n        speedFactor: this.renderMode === RenderMode.StretchedBillBoard ? this.speedFactor : 0,\n        texture: this.texture.uuid,\n        startTileIndex: this.startTileIndex,\n        uTileCount: this.uTileCount,\n        vTileCount: this.vTileCount,\n        blending: this.blending,\n        behaviors: this.behaviors.map(function (behavior) {\n          return behavior.toJSON();\n        }),\n        worldSpace: this.worldSpace\n      };\n    }\n  }, {\n    key: \"addBehavior\",\n    value: function addBehavior(behavior) {\n      this.behaviors.push(behavior);\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json, textures) {\n      var shape;\n\n      switch (json.shape.type) {\n        case 'cone':\n          shape = new ConeEmitter(json.shape);\n          break;\n\n        case 'donut':\n          shape = new DonutEmitter(json.shape);\n          break;\n\n        case 'point':\n          shape = new PointEmitter();\n          break;\n\n        case 'sphere':\n          shape = new SphereEmitter(json.shape);\n          break;\n\n        default:\n          shape = new PointEmitter();\n          break;\n      }\n\n      return new ParticleSystem({\n        autoDestroy: json.autoDestroy,\n        looping: json.looping,\n        duration: json.duration,\n        maxParticle: json.maxParticle,\n        shape: shape,\n        startLife: ValueGeneratorFromJSON(json.startLife),\n        startSpeed: ValueGeneratorFromJSON(json.startSpeed),\n        startRotation: ValueGeneratorFromJSON(json.startRotation),\n        startSize: ValueGeneratorFromJSON(json.startSize),\n        startColor: ColorGeneratorFromJSON(json.startColor),\n        emissionOverTime: ValueGeneratorFromJSON(json.emissionOverTime),\n        emissionOverDistance: ValueGeneratorFromJSON(json.emissionOverDistance),\n        emissionBursts: json.emissionBursts,\n        instancingGeometry: json.instancingGeometry,\n        renderMode: json.renderMode,\n        speedFactor: json.speedFactor,\n        texture: textures[json.texture],\n        startTileIndex: json.startTileIndex,\n        uTileCount: json.uTileCount,\n        vTileCount: json.vTileCount,\n        blending: json.blending,\n        behaviors: json.behaviors.map(function (behavior) {\n          return BehaviorFromJSON(behavior);\n        }),\n        worldSpace: json.worldSpace\n      });\n    }\n  }]);\n\n  return ParticleSystem;\n}();\n\nvar TEXTURE_MAPPING = {\n  UVMapping: UVMapping,\n  CubeReflectionMapping: CubeReflectionMapping,\n  CubeRefractionMapping: CubeRefractionMapping,\n  EquirectangularReflectionMapping: EquirectangularReflectionMapping,\n  EquirectangularRefractionMapping: EquirectangularRefractionMapping,\n  //SphericalReflectionMapping: SphericalReflectionMapping,\n  CubeUVReflectionMapping: CubeUVReflectionMapping,\n  CubeUVRefractionMapping: CubeUVRefractionMapping\n};\nvar TEXTURE_WRAPPING = {\n  RepeatWrapping: RepeatWrapping,\n  ClampToEdgeWrapping: ClampToEdgeWrapping,\n  MirroredRepeatWrapping: MirroredRepeatWrapping\n};\nvar TEXTURE_FILTER = {\n  NearestFilter: NearestFilter,\n  NearestMipmapNearestFilter: NearestMipMapNearestFilter,\n  NearestMipmapLinearFilter: NearestMipMapLinearFilter,\n  LinearFilter: LinearFilter,\n  LinearMipmapNearestFilter: LinearMipMapNearestFilter,\n  LinearMipmapLinearFilter: LinearMipMapLinearFilter\n};\n\nvar QuarksLoader = /*#__PURE__*/function () {\n  function QuarksLoader(manager) {\n    _classCallCheck(this, QuarksLoader);\n\n    _defineProperty(this, \"manager\", void 0);\n\n    _defineProperty(this, \"crossOrigin\", \"anonymous\");\n\n    _defineProperty(this, \"path\", void 0);\n\n    _defineProperty(this, \"resourcePath\", void 0);\n\n    this.manager = manager !== undefined ? manager : DefaultLoadingManager;\n    this.resourcePath = '';\n  }\n\n  _createClass(QuarksLoader, [{\n    key: \"setPath\",\n    value: function setPath(value) {\n      this.path = value;\n      return this;\n    }\n  }, {\n    key: \"setResourcePath\",\n    value: function setResourcePath(value) {\n      this.resourcePath = value;\n      return this;\n    }\n  }, {\n    key: \"setCrossOrigin\",\n    value: function setCrossOrigin(value) {\n      this.crossOrigin = value;\n      return this;\n    }\n  }, {\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var path = this.path === undefined ? LoaderUtils.extractUrlBase(url) : this.path;\n      this.resourcePath = this.resourcePath || path;\n      var loader = new FileLoader(scope.manager);\n      if (this.path) loader.setPath(this.path);\n      loader.load(url, function (text) {\n        var json = null;\n\n        try {\n          json = JSON.parse(text);\n        } catch (error) {\n          if (onError !== undefined) onError(error);\n          console.error('THREE:ObjectLoader: Can\\'t parse ' + url + '.', error.message);\n          return;\n        }\n\n        var metadata = json.metadata;\n\n        if (metadata === undefined || metadata.type === undefined || metadata.type.toLowerCase() === 'geometry') {\n          console.error('THREE.ObjectLoader: Can\\'t load ' + url);\n          return;\n        }\n\n        scope.parse(json, onLoad);\n      }, onProgress, onError);\n    }\n  }, {\n    key: \"loadImage\",\n    value: function loadImage(loader, url) {\n      var scope = this;\n      scope.manager.itemStart(url);\n      return loader.load(url, function () {\n        scope.manager.itemEnd(url);\n      }, undefined, function () {\n        scope.manager.itemError(url);\n        scope.manager.itemEnd(url);\n      });\n    }\n  }, {\n    key: \"parseImages\",\n    value: function parseImages(json, onLoad) {\n      var scope = this;\n      var images = {};\n\n      if (json !== undefined && json.length > 0) {\n        var manager = new LoadingManager(onLoad);\n        var loader = new ImageLoader(manager);\n        loader.setCrossOrigin(this.crossOrigin);\n\n        for (var i = 0, il = json.length; i < il; i++) {\n          var image = json[i];\n          var url = image.url;\n\n          if (Array.isArray(url)) {\n            // load array of images e.g CubeTexture\n            images[image.uuid] = [];\n\n            for (var j = 0, jl = url.length; j < jl; j++) {\n              var currentUrl = url[j];\n              var path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(currentUrl) ? currentUrl : scope.resourcePath + currentUrl;\n              images[image.uuid].push(this.loadImage(loader, path));\n            }\n          } else {\n            // load single image\n            var path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(image.url) ? image.url : scope.resourcePath + image.url;\n            images[image.uuid] = this.loadImage(loader, path);\n          }\n        }\n      }\n\n      return images;\n    }\n  }, {\n    key: \"parseTextures\",\n    value: function parseTextures(json, images) {\n      function parseConstant(value, type) {\n        if (typeof value === 'number') return value;\n        console.warn('THREE.ObjectLoader.parseTexture: Constant should be in numeric form.', value);\n        return type[value];\n      }\n\n      var textures = {};\n\n      if (json !== undefined) {\n        for (var i = 0, l = json.length; i < l; i++) {\n          var data = json[i];\n\n          if (data.image === undefined) {\n            console.warn('THREE.ObjectLoader: No \"image\" specified for', data.uuid);\n          }\n\n          if (images[data.image] === undefined) {\n            console.warn('THREE.ObjectLoader: Undefined image', data.image);\n          }\n\n          var texture;\n\n          if (Array.isArray(images[data.image])) {\n            texture = new CubeTexture(images[data.image]);\n          } else {\n            texture = new Texture(images[data.image]);\n          }\n\n          texture.needsUpdate = true;\n          texture.uuid = data.uuid;\n          if (data.name !== undefined) texture.name = data.name;\n          if (data.mapping !== undefined) texture.mapping = parseConstant(data.mapping, TEXTURE_MAPPING);\n          if (data.offset !== undefined) texture.offset.fromArray(data.offset);\n          if (data.repeat !== undefined) texture.repeat.fromArray(data.repeat);\n          if (data.center !== undefined) texture.center.fromArray(data.center);\n          if (data.rotation !== undefined) texture.rotation = data.rotation;\n\n          if (data.wrap !== undefined) {\n            texture.wrapS = parseConstant(data.wrap[0], TEXTURE_WRAPPING);\n            texture.wrapT = parseConstant(data.wrap[1], TEXTURE_WRAPPING);\n          }\n\n          if (data.format !== undefined) texture.format = data.format;\n          if (data.type !== undefined) texture.type = data.type;\n          if (data.encoding !== undefined) texture.encoding = data.encoding;\n          if (data.minFilter !== undefined) texture.minFilter = parseConstant(data.minFilter, TEXTURE_FILTER);\n          if (data.magFilter !== undefined) texture.magFilter = parseConstant(data.magFilter, TEXTURE_FILTER);\n          if (data.anisotropy !== undefined) texture.anisotropy = data.anisotropy;\n          if (data.flipY !== undefined) texture.flipY = data.flipY;\n          if (data.premultiplyAlpha !== undefined) texture.premultiplyAlpha = data.premultiplyAlpha;\n          if (data.unpackAlignment !== undefined) texture.unpackAlignment = data.unpackAlignment;\n          textures[data.uuid] = texture;\n        }\n      }\n\n      return textures;\n    }\n  }, {\n    key: \"parseObject\",\n    value: function parseObject(data, textures) {\n      var object;\n\n      switch (data.type) {\n        case 'ParticleEmitter':\n          object = ParticleSystem.fromJSON(data.ps, textures).emitter;\n          break;\n\n        case 'Group':\n          object = new Group();\n          break;\n\n        default:\n          object = new Object3D();\n      }\n\n      object.uuid = data.uuid;\n      if (data.name !== undefined) object.name = data.name;\n\n      if (data.matrix !== undefined) {\n        object.matrix.fromArray(data.matrix);\n        if (data.matrixAutoUpdate !== undefined) object.matrixAutoUpdate = data.matrixAutoUpdate;\n        if (object.matrixAutoUpdate) object.matrix.decompose(object.position, object.quaternion, object.scale);\n      } else {\n        if (data.position !== undefined) object.position.fromArray(data.position);\n        if (data.rotation !== undefined) object.rotation.fromArray(data.rotation);\n        if (data.quaternion !== undefined) object.quaternion.fromArray(data.quaternion);\n        if (data.scale !== undefined) object.scale.fromArray(data.scale);\n      }\n\n      if (data.castShadow !== undefined) object.castShadow = data.castShadow;\n      if (data.receiveShadow !== undefined) object.receiveShadow = data.receiveShadow;\n      if (data.visible !== undefined) object.visible = data.visible;\n      if (data.frustumCulled !== undefined) object.frustumCulled = data.frustumCulled;\n      if (data.renderOrder !== undefined) object.renderOrder = data.renderOrder;\n      if (data.userData !== undefined) object.userData = data.userData;\n      if (data.layers !== undefined) object.layers.mask = data.layers;\n\n      if (data.children !== undefined) {\n        var children = data.children;\n\n        for (var i = 0; i < children.length; i++) {\n          object.add(this.parseObject(children[i], textures));\n        }\n      }\n\n      return object;\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(json, onLoad) {\n      var images = this.parseImages(json.images, function () {\n        if (onLoad !== undefined) onLoad(object);\n      });\n      var textures = this.parseTextures(json.textures, images);\n      var object = this.parseObject(json.object, textures);\n\n      if (json.images === undefined || json.images.length === 0) {\n        if (onLoad !== undefined) onLoad(object);\n      }\n\n      return object;\n    }\n  }]);\n\n  return QuarksLoader;\n}();\n\nvar Gradient = /*#__PURE__*/function (_PiecewiseFunction2) {\n  _inherits(Gradient, _PiecewiseFunction2);\n\n  var _super3 = _createSuper(Gradient);\n\n  // default linear bezier\n  function Gradient() {\n    var _this3;\n\n    var functions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [[new ColorRange(new Vector4(0, 0, 0, 1), new Vector4(1, 1, 1, 1)), 0]];\n\n    _classCallCheck(this, Gradient);\n\n    _this3 = _super3.call(this);\n\n    _defineProperty(_assertThisInitialized(_this3), \"type\", void 0);\n\n    _this3.type = \"function\";\n    _this3.functions = functions;\n    return _this3;\n  }\n\n  _createClass(Gradient, [{\n    key: \"genColor\",\n    value: function genColor(color, t) {\n      var index = this.findFunction(t);\n\n      if (index === -1) {\n        console.error(t);\n        return color.copy(this.functions[0][0].a);\n      }\n\n      return this.getFunction(index).genColor(color, t);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        type: \"Gradient\",\n        functions: this.functions.map(function (_ref3) {\n          var _ref4 = _slicedToArray(_ref3, 2),\n              range = _ref4[0],\n              start = _ref4[1];\n\n          return {\n            function: range.toJSON(),\n            start: start\n          };\n        })\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      return new Gradient(json.functions.map(function (piecewiseFunction) {\n        return [ColorRange.fromJSON(piecewiseFunction.function), piecewiseFunction.start];\n      }));\n    }\n  }]);\n\n  return Gradient;\n}(PiecewiseFunction);\n\nexport { BehaviorFromJSON, Bezier, ColorGeneratorFromJSON, ColorOverLife, ColorRange, ConeEmitter, ConstantColor, ConstantValue, DonutEmitter, FrameOverLife, Gradient, IntervalValue, Particle, ParticleEmitter, ParticleSystem, PiecewiseBezier, PiecewiseFunction, PointEmitter, QuarksLoader, RandomColor, RenderMode, RotationOverLife, SizeOverLife, SphereEmitter, ValueGeneratorFromJSON };","import {AdditiveBlending, Group, NormalBlending, TextureLoader, Vector4} from \"three\";\r\nimport {ColorOverLife, ParticleSystem, RenderMode} from \"three.quarks\";\r\nimport {ConeEmitter} from \"three.quarks\";\r\nimport {IntervalValue} from \"three.quarks\";\r\nimport {SizeOverLife} from \"three.quarks\";\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {ColorRange} from \"three.quarks\";\r\nimport {ConstantColor} from \"three.quarks\";\r\nimport {SphereEmitter} from \"three.quarks\";\r\nimport {RotationOverLife} from \"three.quarks\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {Bezier} from \"three.quarks\";\r\nimport {Gradient} from \"three.quarks\";\r\nimport {RandomColor} from \"three.quarks\";\r\n\r\nexport class ToonProjectile extends Group {\r\n    private particles: ParticleSystem;\r\n    private smoke: ParticleSystem;\r\n    private glowBeam: ParticleSystem;\r\n    private mainBeam: ParticleSystem;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        let texture = new TextureLoader().load( \"textures/texture1.png\");\r\n        texture.name = \"textures/texture1.png\";\r\n\r\n        this.mainBeam = new ParticleSystem({\r\n            duration: 1,\r\n            looping: true,\r\n            startLife: new IntervalValue(0.1, 0.15),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new ConstantValue(1.25),\r\n            startColor: new ConstantColor(new Vector4(1, 1, 1, .5)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(40),\r\n\r\n            shape: new SphereEmitter({\r\n                radius: .0001,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.mainBeam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.mainBeam.emitter.renderOrder = 2;\r\n        this.mainBeam.emitter.name = 'mainBeam';\r\n\r\n        this.add(this.mainBeam.emitter);\r\n\r\n        this.glowBeam = new ParticleSystem({\r\n            duration: 1,\r\n            looping: true,\r\n            startLife: new IntervalValue(0.1, 0.15),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new ConstantValue(3.5),\r\n            startColor: new ConstantColor(new Vector4(1, 0.1509503, 0.07352942, .5)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(40),\r\n\r\n            shape: new SphereEmitter({\r\n                radius: .0001,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 1,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.glowBeam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.glowBeam.emitter.renderOrder = 2;\r\n        this.glowBeam.emitter.name = 'glowBeam';\r\n\r\n        this.add(this.glowBeam.emitter);\r\n\r\n\r\n        this.particles = new ParticleSystem({\r\n            duration: 1,\r\n            looping: true,\r\n            startLife: new IntervalValue(0.3, 0.6),\r\n            startSpeed: new IntervalValue(2, 5),\r\n            startSize: new IntervalValue(.1, .4),\r\n            startColor: new RandomColor(new Vector4(1,1,1,.5), new Vector4(1, 0.1509503, 0.07352942, .5)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(60),\r\n\r\n            shape: new ConeEmitter({\r\n                angle: 4.8423 / 180 * Math.PI,\r\n                radius: .3,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            renderMode: RenderMode.StretchedBillBoard,\r\n            speedFactor: .01,\r\n            blending: NormalBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.particles.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.particles.emitter.renderOrder = 0;\r\n        this.particles.emitter.rotateY(-Math.PI/2);\r\n        this.particles.emitter.name = 'particles';\r\n\r\n        this.add(this.particles.emitter);\r\n\r\n        this.smoke = new ParticleSystem({\r\n            startLife: new IntervalValue(0.25, 0.3),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new IntervalValue(.75, 1.25),\r\n            startRotation: new IntervalValue(0, Math.PI * 2),\r\n            startColor: new ConstantColor(new Vector4(1,1,1,.5)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(20),\r\n            shape: new SphereEmitter({\r\n                radius: .2,\r\n                thickness: 1,\r\n            }),\r\n\r\n            texture: texture,\r\n            blending: NormalBlending,\r\n            startTileIndex: 2,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.smoke.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.smoke.addBehavior(new ColorOverLife(new ColorRange(new Vector4(1, 0.1509503, 0.07352942, 1), new Vector4(0, 0, 0, 0))));\r\n        this.smoke.addBehavior(new RotationOverLife(new IntervalValue(-Math.PI * 2, Math.PI * 2)));\r\n        this.smoke.emitter.renderOrder = -2;\r\n        this.smoke.emitter.name = 'smoke';\r\n\r\n        this.add(this.smoke.emitter);\r\n\r\n    }\r\n\r\n    update(delta: number) {\r\n        this.mainBeam.update(delta);\r\n        this.glowBeam.update(delta);\r\n        this.particles.update(delta);\r\n        this.smoke.update(delta);\r\n    }\r\n}\r\n","import {AdditiveBlending, Group, NormalBlending, TextureLoader, Vector4} from \"three\";\r\nimport {ColorOverLife, ParticleSystem, PointEmitter, RenderMode, RotationOverLife} from \"three.quarks\";\r\nimport {ConeEmitter} from \"three.quarks\";\r\nimport {IntervalValue} from \"three.quarks\";\r\nimport {SizeOverLife} from \"three.quarks\";\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {ColorRange} from \"three.quarks\";\r\nimport {ConstantColor} from \"three.quarks\";\r\nimport {SphereEmitter} from \"three.quarks\";\r\nimport {FrameOverLife} from \"three.quarks\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {Bezier} from \"three.quarks\";\r\nimport {Gradient} from \"three.quarks\";\r\nimport {RandomColor} from \"three.quarks\";\r\n\r\nexport class BulletMuzzle extends Group {\r\n    private beam: ParticleSystem;\r\n    private muzzle1: ParticleSystem;\r\n    private muzzle2: ParticleSystem;\r\n    private flash: ParticleSystem;\r\n    private smoke: ParticleSystem;\r\n    private particles: ParticleSystem;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        let texture = new TextureLoader().load( \"textures/texture1.png\");\r\n        texture.name = \"textures/texture1.png\";\r\n\r\n        this.beam = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.1, 0.2),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new ConstantValue(4),\r\n            startColor: new ConstantColor(new Vector4(1, 0.585716, 0.1691176, 1)),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 10,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 1,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 1,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.beam.emitter.renderOrder = 0;\r\n        this.beam.emitter.name = 'beam';\r\n        this.beam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.add(this.beam.emitter);\r\n\r\n        let muzzle = {\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.1, 0.2),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new IntervalValue(1, 5),\r\n            startColor: new ConstantColor(new Vector4(1, 1, 1, 1)),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 5,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 1,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 91,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.LocalSpaceBillBoard\r\n        };\r\n\r\n        this.muzzle1 = new ParticleSystem(muzzle);\r\n        this.muzzle1.addBehavior(new ColorOverLife(new ColorRange(new Vector4(1, 0.3882312, 0.125, 1), new Vector4(1, 0.826827, 0.3014706, 1))));\r\n        this.muzzle1.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.muzzle1.addBehavior(new FrameOverLife(new PiecewiseBezier([[new Bezier(91, 94, 97, 100), 0]])));\r\n        this.muzzle1.emitter.renderOrder = 2;\r\n        this.muzzle1.emitter.name = 'muzzle1';\r\n        this.muzzle1.emitter.position.x = 1;\r\n        this.add(this.muzzle1.emitter);\r\n\r\n        this.muzzle2 = new ParticleSystem(muzzle);\r\n        this.muzzle2.addBehavior(new ColorOverLife(new ColorRange(new Vector4(1, 0.3882312, 0.125, 1), new Vector4(1, 0.826827, 0.3014706, 1))));\r\n        this.muzzle2.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.muzzle2.addBehavior(new FrameOverLife(new PiecewiseBezier([[new Bezier(91, 94, 97, 100), 0]])));\r\n        this.muzzle2.emitter.renderOrder = 2;\r\n        this.muzzle2.emitter.name = 'muzzle2';\r\n        this.muzzle2.emitter.position.x = 1;\r\n        this.muzzle2.emitter.rotation.x = Math.PI / 2;\r\n        this.add(this.muzzle2.emitter);\r\n\r\n        this.flash = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.1, 0.2),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new IntervalValue(1, 2.5),\r\n            startRotation: new IntervalValue(-Math.PI, Math.PI),\r\n            startColor: new ConstantColor(new Vector4(1, 1, 1, 1)),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 5,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 2,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 81,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        this.flash.addBehavior(new ColorOverLife(new ColorRange(new Vector4(1, 0.95, 0.82, 1), new Vector4(1, 0.38, 0.12, 1))));\r\n        this.flash.addBehavior(new FrameOverLife(new PiecewiseBezier([[new Bezier(81, 84.333, 87.666, 91), 0]])));\r\n        this.flash.emitter.renderOrder = 2;\r\n        this.flash.emitter.name = 'flash';\r\n        this.add(this.flash.emitter);\r\n\r\n        this.smoke = new ParticleSystem({\r\n            duration: 2.5,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.6, 0.8),\r\n            startSpeed: new IntervalValue(0.1, 3),\r\n            startSize: new IntervalValue(0.75, 1.5),\r\n            startRotation: new IntervalValue(-Math.PI, Math.PI),\r\n            startColor: new RandomColor(new Vector4(0.6323, 0.6323, 0.6323, .31), new Vector4(1, 1, 1, 0.54)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 10,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 5,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new ConeEmitter({\r\n                angle: 20 * Math.PI / 180,\r\n                radius: 0.3,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: NormalBlending,\r\n            startTileIndex: 81,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        this.smoke.addBehavior(new ColorOverLife(new ColorRange(new Vector4(1, 1, 1, 1), new Vector4(1, 1, 1, 0))));\r\n        this.smoke.addBehavior(new RotationOverLife(new IntervalValue(- Math.PI / 4, Math.PI / 4)));\r\n        this.smoke.addBehavior(new FrameOverLife(new PiecewiseBezier([[new Bezier(28, 31, 34, 37), 0]])));\r\n        this.smoke.emitter.renderOrder = -2;\r\n        this.smoke.emitter.name = 'smoke';\r\n        this.smoke.emitter.rotation.y = Math.PI / 2;\r\n        this.add(this.smoke.emitter);\r\n\r\n        this.particles = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.2, 0.6),\r\n            startSpeed: new IntervalValue(1, 15),\r\n            startSize: new IntervalValue(0.1, 0.3),\r\n            startColor: new RandomColor(new Vector4(1, 0.91, 0.51, 1), new Vector4(1, 0.44, 0.16, 1)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 10,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 8,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new ConeEmitter({\r\n                angle: 20 * Math.PI / 180,\r\n                radius: 0.3,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.StretchedBillBoard,\r\n            speedFactor: 0.5,\r\n        });\r\n        this.particles.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.particles.emitter.renderOrder = 1;\r\n        this.particles.emitter.name = 'particles';\r\n        this.particles.emitter.rotation.y = Math.PI / 2;\r\n        this.add(this.particles.emitter);\r\n    }\r\n\r\n    update(delta: number) {\r\n        this.beam.update(delta);\r\n        this.muzzle1.update(delta);\r\n        this.muzzle2.update(delta);\r\n        this.flash.update(delta);\r\n        this.smoke.update(delta);\r\n        this.particles.update(delta);\r\n    }\r\n}\r\n","import {AdditiveBlending, Group, NormalBlending, TextureLoader, Vector4} from \"three\";\r\nimport {ColorOverLife, ParticleSystem, PointEmitter, RenderMode, RotationOverLife} from \"three.quarks\";\r\nimport {ConeEmitter} from \"three.quarks\";\r\nimport {IntervalValue} from \"three.quarks\";\r\nimport {SizeOverLife} from \"three.quarks\";\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {ColorRange} from \"three.quarks\";\r\nimport {ConstantColor} from \"three.quarks\";\r\nimport {SphereEmitter} from \"three.quarks\";\r\nimport {FrameOverLife} from \"three.quarks\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {Bezier} from \"three.quarks\";\r\nimport {Gradient} from \"three.quarks\";\r\nimport {RandomColor} from \"three.quarks\";\r\n\r\nexport class BulletProjectile extends Group {\r\n    private hProjectile: ParticleSystem;\r\n    private vProjectile: ParticleSystem;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        let texture = new TextureLoader().load( \"textures/projectile.png\");\r\n        texture.name = \"textures/projectile.png\";\r\n\r\n        let projectileParam = {\r\n            duration: 1,\r\n            looping: true,\r\n            startLife: new ConstantValue(0.5),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new IntervalValue(1, 2),\r\n            startColor: new ConstantColor(new Vector4(1, 1, 1, 1)),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 10,\r\n            emissionOverTime: new ConstantValue(4),\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 1,\r\n            vTileCount: 1,\r\n            instancingGeometry: [\r\n                -2, -0.5, 0, 0, 0,\r\n                2, -0.5, 0, 1, 0,\r\n                2, 0.5, 0, 1, 1,\r\n                -2, 0.5, 0, 0, 1\r\n            ],\r\n            renderMode: RenderMode.LocalSpaceBillBoard\r\n        };\r\n\r\n        this.hProjectile = new ParticleSystem(projectileParam);\r\n        this.hProjectile.addBehavior(new ColorOverLife(new Gradient([\r\n            [new ColorRange(new Vector4(1, 1, 1, 0), new Vector4(0, 1, 0.25, 1)), 0],\r\n            [new ColorRange(new Vector4(0, 1, 0.25, 1), new Vector4(1, 1, 1, 0)), 0.5]\r\n        ])));\r\n        this.hProjectile.emitter.renderOrder = 2;\r\n        this.hProjectile.emitter.name = 'hProjectile';\r\n        this.add(this.hProjectile.emitter);\r\n\r\n        this.vProjectile = new ParticleSystem(projectileParam);\r\n        this.vProjectile.addBehavior(new ColorOverLife(new Gradient([\r\n            [new ColorRange(new Vector4(1, 1, 1, 0), new Vector4(0, 1, 0.25, 1)), 0],\r\n            [new ColorRange(new Vector4(0, 1, 0.25, 1), new Vector4(1, 1, 1, 0)), 0.5]\r\n        ])));\r\n        this.vProjectile.emitter.renderOrder = 2;\r\n        this.vProjectile.emitter.name = 'vProjectile';\r\n        this.vProjectile.emitter.rotation.x = Math.PI / 2;\r\n        this.add(this.vProjectile.emitter);\r\n    }\r\n\r\n    update(delta: number) {\r\n        this.hProjectile.update(delta);\r\n        this.vProjectile.update(delta);\r\n    }\r\n}\r\n","import {AdditiveBlending, Group, NormalBlending, TextureLoader, Vector4} from \"three\";\r\nimport {ColorOverLife, ParticleSystem, PointEmitter, RenderMode, RotationOverLife} from \"three.quarks\";\r\nimport {ConeEmitter} from \"three.quarks\";\r\nimport {IntervalValue} from \"three.quarks\";\r\nimport {SizeOverLife} from \"three.quarks\";\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {ColorRange} from \"three.quarks\";\r\nimport {ConstantColor} from \"three.quarks\";\r\nimport {SphereEmitter} from \"three.quarks\";\r\nimport {FrameOverLife} from \"three.quarks\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {Bezier} from \"three.quarks\";\r\nimport {Gradient} from \"three.quarks\";\r\nimport {RandomColor} from \"three.quarks\";\r\n\r\nexport class BulletHit extends Group {\r\n    private hProjectile: ParticleSystem;\r\n    private vProjectile: ParticleSystem;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        let texture = new TextureLoader().load( \"textures/projectile.png\");\r\n        texture.name = \"textures/projectile.png\";\r\n\r\n        let projectileParam = {\r\n            duration: 1,\r\n            looping: true,\r\n            startLife: new ConstantValue(0.5),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new IntervalValue(1.5, 2),\r\n            startColor: new ConstantColor(new Vector4(1, 1, 1, 1)),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 10,\r\n            emissionOverTime: new ConstantValue(4),\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 1,\r\n            vTileCount: 1,\r\n            renderMode: RenderMode.LocalSpaceBillBoard\r\n        };\r\n\r\n        this.hProjectile = new ParticleSystem(projectileParam);\r\n        this.hProjectile.addBehavior(new ColorOverLife(new Gradient([\r\n            [new ColorRange(new Vector4(1, 1, 1, 0), new Vector4(0, 1, 0.25, 1)), 0],\r\n            [new ColorRange(new Vector4(0, 1, 0.25, 1), new Vector4(1, 1, 1, 0)), 0.5]\r\n        ])));\r\n        this.hProjectile.emitter.renderOrder = 2;\r\n        this.hProjectile.emitter.name = 'hProjectile';\r\n        this.hProjectile.emitter.scale.x = 2;\r\n        this.add(this.hProjectile.emitter);\r\n\r\n        this.vProjectile = new ParticleSystem(projectileParam);\r\n        this.vProjectile.addBehavior(new ColorOverLife(new Gradient([\r\n            [new ColorRange(new Vector4(1, 1, 1, 0), new Vector4(0, 1, 0.25, 1)), 0],\r\n            [new ColorRange(new Vector4(0, 1, 0.25, 1), new Vector4(1, 1, 1, 0)), 0.5]\r\n        ])));\r\n        this.vProjectile.emitter.renderOrder = 2;\r\n        this.vProjectile.emitter.name = 'vProjectile';\r\n        this.vProjectile.emitter.rotation.x = Math.PI / 2;\r\n        this.vProjectile.emitter.scale.x = 10;\r\n        this.add(this.vProjectile.emitter);\r\n    }\r\n\r\n    update(delta: number) {\r\n        this.hProjectile.update(delta);\r\n        this.vProjectile.update(delta);\r\n    }\r\n}\r\n","import {AdditiveBlending, Group, NormalBlending, TextureLoader, Vector4} from \"three\";\r\nimport {FrameOverLife, ParticleSystem, PointEmitter, RenderMode} from \"three.quarks\";\r\nimport {ConeEmitter} from \"three.quarks\";\r\nimport {IntervalValue} from \"three.quarks\";\r\nimport {SizeOverLife} from \"three.quarks\";\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {ColorRange} from \"three.quarks\";\r\nimport {ConstantColor} from \"three.quarks\";\r\nimport {SphereEmitter} from \"three.quarks\";\r\nimport {RotationOverLife} from \"three.quarks\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {Bezier} from \"three.quarks\";\r\nimport {ColorOverLife} from \"three.quarks\";\r\nimport {RandomColor} from \"three.quarks\";\r\n\r\n// TODO\r\nexport class ToonExplosion extends Group {\r\n    private mainBeam: ParticleSystem;\r\n    private glowBeam: ParticleSystem;\r\n    private particles: ParticleSystem;\r\n    private beam: ParticleSystem;\r\n    private smoke: ParticleSystem;\r\n    private circle: ParticleSystem;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        let texture = new TextureLoader().load( \"textures/texture1.png\");\r\n        texture.name = \"textures/texture1.png\";\r\n        this.mainBeam = new ParticleSystem({\r\n            duration: 2,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.1, 0.3),\r\n            startSpeed: new IntervalValue(5, 15),\r\n            startSize: new IntervalValue(1.5, 1.25),\r\n            startColor: new ConstantColor(new Vector4(1, 1, 1, 1)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 8,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new ConeEmitter({\r\n                angle: 25 * Math.PI / 180,\r\n                radius: 0.2,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.mainBeam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.mainBeam.emitter.renderOrder = 2;\r\n        this.mainBeam.emitter.name = 'mainBeam';\r\n        this.add(this.mainBeam.emitter);\r\n\r\n        this.glowBeam = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n\r\n            startLife: new IntervalValue(1, 1.6),\r\n            startSpeed: new IntervalValue(0.7, 1.5),\r\n            startSize: new IntervalValue(0.4, 0.8),\r\n            startColor: new ConstantColor(new Vector4(1, 0.1509503, 0.07352942, .5)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 8,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new ConeEmitter({\r\n                angle: 80 * Math.PI / 180,\r\n                radius: 0.25,\r\n                thickness: 0.5,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.glowBeam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.glowBeam.emitter.renderOrder = 2;\r\n        this.glowBeam.emitter.name = 'glowBeam';\r\n        this.add(this.glowBeam.emitter);\r\n\r\n        this.smoke = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.5, 0.8),\r\n            startSpeed: new IntervalValue(1, 2.5),\r\n            startSize: new IntervalValue(1, 1.5),\r\n            startRotation: new IntervalValue(0, Math.PI * 2),\r\n            startColor: new ConstantColor(new Vector4(1,1,1,.5)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 12,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new SphereEmitter({\r\n                radius: .75,\r\n                thickness: 1,\r\n            }),\r\n\r\n            texture: texture,\r\n            blending: NormalBlending,\r\n            startTileIndex: 2,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.smoke.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.smoke.addBehavior(new ColorOverLife(new ColorRange(new Vector4(1, 0.1509503, 0.07352942, 1), new Vector4(0, 0, 0, 0))));\r\n        this.smoke.addBehavior(new RotationOverLife(new IntervalValue(-Math.PI * 2, Math.PI * 2)));\r\n        this.smoke.emitter.renderOrder = -2;\r\n        this.smoke.emitter.name = 'smoke';\r\n        this.add(this.smoke.emitter);\r\n\r\n        this.particles = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.6, 1.2),\r\n            startSpeed: new IntervalValue(2, 10),\r\n            startSize: new IntervalValue(.1, .4),\r\n            startColor: new RandomColor(new Vector4(1,1,1,1), new Vector4(1, 0.1509503, 0.07352942, 1)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 12,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new ConeEmitter({\r\n                angle: 50 / 180 * Math.PI,\r\n                radius: .5,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: NormalBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.StretchedBillBoard,\r\n            speedFactor: 0.5,\r\n        });\r\n        this.particles.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.particles.emitter.renderOrder = 0;\r\n        this.particles.emitter.name = 'particles';\r\n        this.add(this.particles.emitter);\r\n\r\n        this.beam = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n\r\n            startLife: new ConstantValue(0.2),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new ConstantValue(7),\r\n            startColor: new ConstantColor(new Vector4(1, 0.3059356, 0.2426471, 1)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 10,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 2,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 1,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.beam.emitter.renderOrder = 0;\r\n        this.beam.emitter.name = 'beam';\r\n        this.beam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.66666, 0.33333, 0), 0]])));\r\n        this.add(this.beam.emitter);\r\n\r\n        this.circle = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new ConstantValue(0.4),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new ConstantValue(4),\r\n            startColor: new ConstantColor(new Vector4(1, 0.3059356, 0.2426471, 1)),\r\n            worldSpace: true,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 1,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 10,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n        });\r\n        this.circle.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(0.3, 0.6, 0.9, 1), 0]])));\r\n        this.circle.addBehavior(new FrameOverLife(new PiecewiseBezier([[new Bezier(10, 13, 16, 19), 0]])));\r\n        this.circle.emitter.renderOrder = 2;\r\n        this.circle.emitter.name = 'circle';\r\n        this.add(this.circle.emitter);\r\n\r\n    }\r\n\r\n    update(delta: number) {\r\n        this.mainBeam.update(delta);\r\n        this.glowBeam.update(delta);\r\n        this.particles.update(delta);\r\n        this.smoke.update(delta);\r\n        this.beam.update(delta);\r\n        this.circle.update(delta);\r\n    }\r\n}","import {AdditiveBlending, Group, NormalBlending, Scene, TextureLoader, Vector4} from \"three\";\r\nimport {\r\n    Bezier, ColorOverLife, ColorRange, ConstantColor,\r\n    ConstantValue, FrameOverLife,\r\n    IntervalValue,\r\n    ParticleSystem,\r\n    PiecewiseBezier, PointEmitter, RandomColor,\r\n    RenderMode, RotationOverLife,\r\n    SizeOverLife,\r\n    SphereEmitter\r\n} from \"three.quarks\";\r\n\r\nexport class Explosion extends Group {\r\n\r\n    static yellowColor = new Vector4(0.9, 0.60, 0.25, 1);\r\n    static yellowColor2 = new Vector4(1, 0.95, 0.4, 1);\r\n\r\n    private gatherParticles: ParticleSystem;\r\n    private mainBeam: ParticleSystem;\r\n    private glowBeam: ParticleSystem;\r\n    private smoke: ParticleSystem;\r\n    private particles: ParticleSystem;\r\n    private beam: ParticleSystem;\r\n    private circle: ParticleSystem;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        let texture = new TextureLoader().load( \"textures/texture1.png\");\r\n        texture.name = \"textures/texture1.png\";\r\n        let mainColor = Explosion.yellowColor;\r\n        let secColor = Explosion.yellowColor2;\r\n\r\n        this.gatherParticles = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.3, 0.4),\r\n            startSpeed: new IntervalValue(-100, -150),\r\n            startSize: new IntervalValue(1, 3),\r\n            startColor: new ConstantColor(new Vector4(1,1,1,1)),\r\n            worldSpace: false,\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0,\r\n                count: 30,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n            shape: new SphereEmitter({\r\n                radius: 40,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        //this.gatherParticles.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.gatherParticles.addBehavior(new ColorOverLife(new ColorRange(new Vector4(mainColor.x, mainColor.y, mainColor.z, .2), new Vector4(mainColor.x, mainColor.y, mainColor.z, 1))));\r\n        this.gatherParticles.emitter.renderOrder = 2;\r\n        this.gatherParticles.emitter.name = 'gatherParticles';\r\n        this.add(this.gatherParticles.emitter);\r\n\r\n        this.mainBeam = new ParticleSystem({\r\n            duration: 2,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.1, 0.3),\r\n            startSpeed: new IntervalValue(100, 300),\r\n            startSize: new IntervalValue(1.5, 12.5),\r\n            startColor: new ConstantColor(new Vector4(1, 1, 1, 1)),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0.4,\r\n                count: 8,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new SphereEmitter({\r\n                radius: 2,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        this.mainBeam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.mainBeam.emitter.renderOrder = 2;\r\n        this.mainBeam.emitter.name = 'mainBeam';\r\n        this.add(this.mainBeam.emitter);\r\n\r\n        this.glowBeam = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n\r\n            startLife: new IntervalValue(1, 1.6),\r\n            startSpeed: new IntervalValue(20, 45),\r\n            startSize: new IntervalValue(4, 8),\r\n            startColor: new ConstantColor(mainColor),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0.4,\r\n                count: 8,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new SphereEmitter({\r\n                radius: 2,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        this.glowBeam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.glowBeam.emitter.renderOrder = 2;\r\n        this.glowBeam.emitter.name = 'glowBeam';\r\n        this.add(this.glowBeam.emitter);\r\n\r\n        this.smoke = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.5, 0.8),\r\n            startSpeed: new IntervalValue(20, 50),\r\n            startSize: new IntervalValue(10, 15),\r\n            startRotation: new IntervalValue(0, Math.PI * 2),\r\n            startColor: new ConstantColor(new Vector4(1,1,1,.5)),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0.4,\r\n                count: 12,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new SphereEmitter({\r\n                radius: 7.5,\r\n                thickness: 1,\r\n            }),\r\n\r\n            texture: texture,\r\n            blending: NormalBlending,\r\n            startTileIndex: 2,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        this.smoke.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.95, 0.75, 0), 0]])));\r\n        this.smoke.addBehavior(new ColorOverLife(new ColorRange(mainColor, new Vector4(0, 0, 0, 0))));\r\n        this.smoke.addBehavior(new RotationOverLife(new IntervalValue(-Math.PI * 2, Math.PI * 2)));\r\n        this.smoke.emitter.renderOrder = -2;\r\n        this.smoke.emitter.name = 'smoke';\r\n        this.add(this.smoke.emitter);\r\n\r\n        this.particles = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new IntervalValue(0.6, 1.2),\r\n            startSpeed: new IntervalValue(40, 200),\r\n            startSize: new IntervalValue(1, 4),\r\n            startColor: new RandomColor(new Vector4(1,1,1,1), mainColor),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0.4,\r\n                count: 12,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new SphereEmitter({\r\n                radius: 2,\r\n                thickness: 1,\r\n                arc: Math.PI * 2,\r\n            }),\r\n            texture: texture,\r\n            blending: NormalBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.StretchedBillBoard,\r\n            speedFactor: 0.1,\r\n        });\r\n        this.particles.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.25, 0.05, 0), 0]])));\r\n        this.particles.emitter.renderOrder = 0;\r\n        this.particles.emitter.name = 'particles';\r\n        this.add(this.particles.emitter);\r\n\r\n        this.beam = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n\r\n            startLife: new ConstantValue(0.2),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new ConstantValue(100),\r\n            startColor: new ConstantColor(secColor),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 10,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0.35,\r\n                count: 2,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 1,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        this.beam.emitter.renderOrder = -2;\r\n        this.beam.emitter.name = 'beam';\r\n        this.beam.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(1, 0.66666, 0.33333, 0), 0]])));\r\n        this.add(this.beam.emitter);\r\n\r\n        this.circle = new ParticleSystem({\r\n            duration: 1,\r\n            looping: false,\r\n            startLife: new ConstantValue(0.4),\r\n            startSpeed: new ConstantValue(0),\r\n            startSize: new ConstantValue(40),\r\n            startColor: new ConstantColor(secColor),\r\n            worldSpace: false,\r\n\r\n            maxParticle: 100,\r\n            emissionOverTime: new ConstantValue(0),\r\n            emissionBursts: [{\r\n                time: 0.4,\r\n                count: 1,\r\n                cycle: 1,\r\n                interval: 0.01,\r\n                probability: 1,\r\n            }],\r\n\r\n            shape: new PointEmitter(),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 10,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            renderMode: RenderMode.BillBoard\r\n        });\r\n        this.circle.addBehavior(new SizeOverLife(new PiecewiseBezier([[new Bezier(0.3, 0.6, 0.9, 1), 0]])));\r\n        this.circle.addBehavior(new FrameOverLife(new PiecewiseBezier([[new Bezier(10, 13, 16, 19), 0]])));\r\n        this.circle.emitter.renderOrder = 2;\r\n        this.circle.emitter.name = 'circle';\r\n        this.add(this.circle.emitter);\r\n    }\r\n\r\n    update(delta: number) {\r\n        //delta /= 1000;\r\n        this.gatherParticles.update(delta);\r\n        this.beam.update(delta);\r\n        this.mainBeam.update(delta);\r\n        this.glowBeam.update(delta);\r\n        this.circle.update(delta);\r\n        this.smoke.update(delta);\r\n        this.particles.update(delta);\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\nimport {Object3D} from \"three\";\r\nimport {ParticleEmitter, QuarksLoader} from \"three.quarks\";\r\nimport {Application} from \"./Application\";\r\nimport {TextureLoader} from \"three\";\r\nimport {ParticleSystem} from \"three.quarks\";\r\nimport {ConeEmitter} from \"three.quarks\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {ConstantColor} from \"three.quarks\";\r\nimport {Vector4} from \"three\";\r\nimport {AdditiveBlending} from \"three\";\r\nimport {Mesh} from \"three\";\r\nimport {BoxBufferGeometry} from \"three\";\r\nimport {MeshStandardMaterial} from \"three\";\r\nimport {ToonProjectile} from \"../example/ToonProjectile\";\r\nimport {Color} from \"three\";\r\nimport {AxesHelper} from \"three\";\r\nimport {PointLight} from \"three\";\r\nimport {AmbientLight} from \"three\";\r\nimport {BulletMuzzle} from \"../example/BulletMuzzle\";\r\nimport {BulletProjectile} from \"../example/BulletProjectile\";\r\nimport {BulletHit} from \"../example/BulletHit\";\r\nimport {ToonExplosion} from \"../example/ToonExplosion\";\r\nimport {Explosion} from \"../example/Explosion\";\r\n\r\n\r\n\r\nexport interface AppContext {\r\n    scene: THREE.Scene;\r\n    script: (delta: number) => void;\r\n    selection: Array<Object3D>;\r\n    actions: {\r\n        onOpenDemo: (index: number)=>void;\r\n        onSaveAs: ()=>void;\r\n        onImport: (files: FileList)=>void;\r\n        select: (object: Object3D) => void;\r\n        selectAddition: (object: Object3D) => void;\r\n        addObject3d: (type: string, parent: Object3D) => void;\r\n        removeObject3d: (object: Object3D) => void;\r\n        duplicateObject3d: (object: Object3D) => void;\r\n        updateParticleSystem: (object: ParticleEmitter) => void;\r\n        updateProperties: () => void;\r\n    }\r\n}\r\n\r\nconst ApplicationContext = React.createContext<AppContext | null>(null);\r\n\r\nexport const ApplicationContextConsumer = ApplicationContext.Consumer;\r\n\r\nexport class ApplicationContextProvider extends React.Component<{ }, AppContext> {\r\n\r\n    createScene(demoIndex: number) {\r\n        const scene = new THREE.Scene();\r\n\r\n        scene.background = new Color(0x666666);\r\n\r\n        let demoObject;\r\n        if (demoIndex === 0) {\r\n            demoObject = new ToonProjectile();\r\n            demoObject.name = \"Toon Projectile\";\r\n            demoObject.userData = {\r\n                script:\r\n                    \"    this.position.x += delta * 30;\\n\" +\r\n                    \"    if (this.position.x > 20)\\n\" +\r\n                    \"        this.position.x = -20;\\n\"\r\n            };\r\n            demoObject.userData.func = new Function(\"delta\", demoObject.userData.script);\r\n        } else if (demoIndex === 1) {\r\n            demoObject = new BulletMuzzle();\r\n            demoObject.name = \"BulletMuzzle\";\r\n        } else if (demoIndex === 2) {\r\n            demoObject = new BulletProjectile();\r\n            demoObject.name = \"BulletProjectile\";\r\n        } else if (demoIndex === 3) {\r\n            demoObject = new BulletHit();\r\n            demoObject.name = \"BulletHit\";\r\n        } else if (demoIndex === 4) {\r\n            demoObject = new ToonExplosion();\r\n            demoObject.name = \"ToonExplosion\";\r\n        } else {\r\n            demoObject = new Explosion();\r\n            demoObject.name = \"Explosion\";\r\n        }\r\n        scene.add(demoObject);\r\n\r\n        const axisHelper = new AxesHelper(100);\r\n        axisHelper.name = \"axisHelper\";\r\n        scene.add(axisHelper);\r\n\r\n        const light = new PointLight(new Color(1, 1, 1), 0.8, 200);\r\n        light.position.set(50, 50, 50);\r\n        scene.add(light);\r\n\r\n        const ambientLight = new AmbientLight(new Color(1, 1, 1), 0.2);\r\n        scene.add(ambientLight);\r\n\r\n        return scene;\r\n    }\r\n\r\n    constructor(props: Readonly<{}>) {\r\n        super(props);\r\n        const state: AppContext = {\r\n            scene: this.createScene(0),\r\n            script: this.animate,\r\n            selection: [],\r\n            actions: {\r\n                onOpenDemo: (index: number) => {\r\n                    const scene = this.createScene(index);\r\n                    this.setState({scene: scene});\r\n                },\r\n                onSaveAs: () => {\r\n                    const a = document.createElement(\"a\");\r\n                    const file = new Blob([JSON.stringify(this.state.scene.toJSON())], {type: \"application/json\"});\r\n                    a.href = URL.createObjectURL(file);\r\n                    a.download = \"scene.json\";\r\n                    a.click();\r\n                },\r\n                onImport: (files: FileList) => {\r\n                    const nFiles = files.length;\r\n                    for (let nFileId = 0; nFileId < nFiles; nFileId++) {\r\n                        const jsonURL = URL.createObjectURL( files[nFileId] );\r\n\r\n                        const loader = new QuarksLoader();\r\n                        loader.setCrossOrigin(\"\");\r\n                        loader.load(jsonURL, (object3D: Object3D)=>{\r\n                            this.state.scene.add(object3D);\r\n                        }, ()=>{}, ()=>{});\r\n                    }\r\n                },\r\n                select: object => {\r\n                    this.setState({selection: [object]});\r\n                },\r\n                selectAddition: object => {\r\n                    if (this.state.selection.indexOf(object) === -1) {\r\n                        this.state.selection.push(object);\r\n                        this.setState({selection: this.state.selection});\r\n                    }\r\n                },\r\n                addObject3d: this.addObject3d,\r\n                removeObject3d: this.removeObject3d,\r\n                duplicateObject3d: () => {\r\n                },\r\n                updateParticleSystem: () => {\r\n                },\r\n                updateProperties: () => {\r\n                    this.setState({scene: this.state.scene});\r\n                }\r\n            }\r\n        };\r\n\r\n        this.state = state;\r\n    }\r\n\r\n    removeObject3d = (object3D: Object3D) => {\r\n        if (object3D.parent) {\r\n            object3D.parent.remove(object3D);\r\n        }\r\n    };\r\n\r\n    addObject3d = (type: string, parent: Object3D) => {\r\n        let object;\r\n        switch (type) {\r\n            case 'particle':\r\n                const texture = new TextureLoader().load(\"textures/texture1.png\");\r\n                const particleSystem = new ParticleSystem({\r\n                    maxParticle: 10000,\r\n                    shape: new ConeEmitter(),\r\n                    emissionOverTime: new ConstantValue(100),\r\n                    startLife: new ConstantValue(30),\r\n                    startSpeed: new ConstantValue(10),\r\n                    startSize: new ConstantValue(1),\r\n                    startColor: new ConstantColor(new Vector4(1, 1, 1, 1)),\r\n                    texture: texture,\r\n                    blending: AdditiveBlending,\r\n                    startTileIndex: 0,\r\n                    uTileCount: 10,\r\n                    vTileCount: 10,\r\n                    worldSpace: true,\r\n                });\r\n                object = particleSystem.emitter;\r\n                this.state.scene.add(object);\r\n                break;\r\n            case 'box':\r\n                object = new Mesh(new BoxBufferGeometry(10, 10, 10), new MeshStandardMaterial({color: 0xcccccc}));\r\n                this.state.scene.add(object);\r\n                break;\r\n        }\r\n        if (object) {\r\n            parent.add(object);\r\n            this.state.actions.select(object);\r\n            this.setState({});\r\n        }\r\n    };\r\n\r\n\r\n    update = 0;\r\n    animate = (delta: number) => {\r\n        /*this.toonProjectile!.position.x += delta * 30;\r\n        if (this.toonProjectile!.position.x > 20)\r\n            this.toonProjectile!.position.x = -20;*/\r\n\r\n        this.update += delta;\r\n        if (this.update > 0.1) {\r\n            this.state.actions.updateProperties();\r\n            this.update = 0;\r\n        }\r\n    };\r\n\r\n    render() {\r\n        //console.log( \"rendering ApplicationContext \");\r\n        return (\r\n            <ApplicationContext.Provider value={this.state}>\r\n                {this.props.children}\r\n            </ApplicationContext.Provider>\r\n        )\r\n    }\r\n}\r\n/*\r\n        this.particleSystem = new ParticleSystem({\r\n            maxParticle: 10000,\r\n            shape: new ConeEmitter(),\r\n            emissionOverTime: new ConstantValue(100),\r\n            startLife: new ConstantValue(30),\r\n            startSpeed: new ConstantValue(10),\r\n            startSize: new ConstantValue(1),\r\n            startColor: new ConstantColor(new Vector4(1,1,1, 1)),\r\n            texture: texture,\r\n            blending: AdditiveBlending,\r\n            startTileIndex: 0,\r\n            uTileCount: 10,\r\n            vTileCount: 10,\r\n            worldSpace: true,\r\n        });*/\r\n//this.particleSystem.emitter.position.set(10, 0, 0);\r\n//scene.add(this.particleSystem.emitter);","import * as React from \"react\";\r\nimport Stats from \"stats.js\";\r\nimport {WEBGL} from \"../WebGL\";\r\nimport {\r\n    PerspectiveCamera,\r\n    WebGLRenderer,\r\n    Clock,\r\n} from \"three\";\r\nimport {RefObject} from \"react\";\r\nimport {OrbitControls} from \"three/examples/jsm/controls/OrbitControls\";\r\nimport {ParticleEmitter} from \"three.quarks\";\r\nimport {AppContext, ApplicationContextConsumer} from \"./ApplicationContext\";\r\n\r\ninterface ThreejsViewportProps {\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nexport class ThreejsViewport extends React.PureComponent<ThreejsViewportProps> {\r\n    container: RefObject<HTMLDivElement>;\r\n    stats?: Stats;\r\n    camera?: PerspectiveCamera;\r\n    renderer?: WebGLRenderer;\r\n    private clock?: Clock;\r\n    private controls?: OrbitControls;\r\n\r\n    private appContext?: AppContext;\r\n\r\n    constructor(props: Readonly<ThreejsViewportProps>) {\r\n        super(props);\r\n        this.container = React.createRef();\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        if ( this.init() ) {\r\n            this.animate();\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<ThreejsViewportProps>, prevState: Readonly<{}>, snapshot?: any): void {\r\n        this.camera!.aspect = this.props.width / this.props.height;\r\n        this.camera!.updateProjectionMatrix();\r\n        this.renderer!.setSize( this.props.width, this.props.height );\r\n    }\r\n\r\n    init() {\r\n        if (!this.container.current) {\r\n            return false;\r\n        }\r\n\r\n        if ( !WEBGL.isWebGLAvailable() ) {\r\n            document.body.appendChild( WEBGL.getWebGLErrorMessage() );\r\n            return false;\r\n        }\r\n\r\n        this.renderer = new WebGLRenderer();\r\n\r\n        /*if ( this.renderer.extensions.get( 'ANGLE_instanced_arrays' ) === null ) {\r\n            document.getElementById( 'notSupported' )!.style.display = '';\r\n            return false;\r\n        }*/\r\n\r\n        const width = this.props.width;\r\n        const height = this.props.height;\r\n\r\n        this.clock = new Clock();\r\n\r\n        this.camera = new PerspectiveCamera( 50, width / height, 1, 1000 );\r\n        this.camera.position.set(50, 50, 50);\r\n\r\n        this.controls = new OrbitControls( this.camera, this.renderer.domElement );\r\n        this.controls.enableKeys = false;\r\n        this.controls.enableDamping = true;\r\n        this.controls.dampingFactor = 0.1;\r\n        this.controls.rotateSpeed = 0.2;\r\n        this.controls.update();\r\n\r\n        this.renderer.setPixelRatio( window.devicePixelRatio );\r\n        this.renderer.setSize( width, height );\r\n        this.container.current!.appendChild( this.renderer.domElement );\r\n\r\n        this.stats = new Stats();\r\n        this.stats.dom.style.position = \"absolute\";\r\n        this.stats.dom.style.left = \"\";\r\n        this.stats.dom.style.right = \"0\";\r\n        this.container.current!.appendChild( this.stats.dom );\r\n\r\n        //window.addEventListener( 'resize', this.onWindowResize, false );\r\n\r\n        this.onResize(null);\r\n\r\n        return true;\r\n\r\n    }\r\n\r\n    onResize = (event: any ) => {\r\n\r\n        if (this.renderer!.domElement.parentElement!.clientWidth - 10 !== this.renderer!.domElement.width ||\r\n            this.renderer!.domElement.parentElement!.clientHeight - 10 !== this.renderer!.domElement.height) {\r\n\r\n            const newWidth = this.renderer!.domElement.parentElement!.clientWidth - 10;\r\n            const newHeight = this.renderer!.domElement.parentElement!.clientHeight - 10;\r\n\r\n            this.camera!.aspect = newWidth / newHeight;\r\n            this.camera!.updateProjectionMatrix();\r\n            this.renderer!.domElement.style.width = '100%';\r\n            this.renderer!.domElement.style.height = '100%';\r\n            this.renderer!.setSize(newWidth, newHeight);\r\n        }\r\n    };\r\n\r\n    animate = () => {\r\n        requestAnimationFrame( this.animate );\r\n\r\n        this.onResize(null);\r\n        this.renderScene();\r\n        this.stats!.update();\r\n    };\r\n\r\n    renderScene() {\r\n        if (this.appContext) {\r\n            this.controls!.update();\r\n            const delta = this.clock!.getDelta();\r\n            //let time = performance.now() * 0.0005;\r\n            //this.particleSystem!.update(this.clock!.getDelta());\r\n            this.appContext.script(delta);\r\n            //this.particleSystem!.emitter.rotation.y = this.clock!.getElapsedTime();\r\n            //this.particleSystem!.emitter.position.set(Math.cos(this.clock!.getElapsedTime()) * 20, 0, Math.sin(this.clock!.getElapsedTime()) * 20);\r\n            //console.log(this.particleSystem!.emitter.modelViewMatrix);\r\n\r\n            this.appContext.scene.traverse(object => {\r\n                if (object.userData && object.userData.func) {\r\n                    object.userData.func.call(object, delta);\r\n                }\r\n                if (object instanceof ParticleEmitter) {\r\n                    /*if (object.name === 'muzzle1' && object.system.particleNum > 0) {\r\n                        console.log(object.system.particles);\r\n                    }*/\r\n                    object.system.update(delta);\r\n                }\r\n            });\r\n\r\n            this.renderer!.render(this.appContext.scene, this.camera!);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        console.log( \"rendering ThreejsViewPort\");\r\n        return (\r\n        <ApplicationContextConsumer>\r\n            { context => {\r\n                    if (context) {\r\n                        this.appContext = context;\r\n                        return <div ref={this.container} style={{width: '100%', height: '100%'}}></div>;\r\n                    }\r\n                }\r\n            }\r\n        </ApplicationContextConsumer>);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport \"./NumberInput.scss\";\r\n\r\ninterface NumberInputProps{\r\n    value: number;\r\n    onChange: (value: number)=>void;\r\n}\r\n\r\nexport const NumberInput : React.FC<NumberInputProps> = (props) => {\r\n\r\n    const [inputValue, setInputValue] = React.useState(props.value + '');\r\n    const [focus, setFocus] = React.useState(false);\r\n\r\n    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (focus) {\r\n            setInputValue(e.target.value);\r\n        }\r\n    };\r\n\r\n    const onInputBlur = (e: React.FocusEvent) => {\r\n        const x = parseFloat(inputValue);\r\n        if (x !== props.value)\r\n            props.onChange(x);\r\n        setFocus(false);\r\n    };\r\n\r\n    const onInputFocus = (e: React.FocusEvent) => {\r\n        if (inputValue !== props.value + '') {\r\n            setInputValue(props.value + '');\r\n        }\r\n        setFocus(true);\r\n    };\r\n\r\n    const onKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter') {\r\n            const x = parseFloat(inputValue);\r\n            if (x !== props.value)\r\n                props.onChange(x);\r\n        }\r\n    };\r\n\r\n    return <input className=\"number-input\" value={focus? inputValue: props.value} size={5}\r\n            onChange={onInputChange} onBlur={onInputBlur} onFocus={onInputFocus} onKeyDown={onKeyDown}\r\n        />;\r\n};\r\n","import * as React from \"react\";\r\nimport {NumberInput} from \"./NumberInput\";\r\n\r\ninterface Vector3Props {\r\n    name: string;\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    onChange: (x: number, y: number, z: number)=>void;\r\n    unitConversion?: number;\r\n}\r\n\r\nexport class Vector3Editor extends React.PureComponent<Vector3Props> {\r\n    render() {\r\n        console.log('rendered Vector3');\r\n        const {x, y, z, unitConversion = 1, onChange, name} = this.props;\r\n        return(<div className=\"property\">\r\n                <label className=\"name\">{name}</label>\r\n                <label>X:</label><NumberInput value={x * unitConversion} onChange={value => {onChange(value / unitConversion, y, z)}}/>\r\n                <label>Y:</label><NumberInput value={y * unitConversion} onChange={value => {onChange(x, value / unitConversion, z)}}/>\r\n                <label>Z:</label><NumberInput value={z * unitConversion} onChange={value => {onChange(x, y, value / unitConversion)}}/>\r\n            </div>\r\n        );\r\n    }\r\n}","import * as React from 'react';\r\n\r\ninterface StringInputProps{\r\n    value: string;\r\n    onChange: (value: string)=>void;\r\n}\r\n\r\nexport const StringInput : React.FC<StringInputProps> = (props) => {\r\n\r\n    const [inputValue, setInputValue] = React.useState(props.value);\r\n    const [focus, setFocus] = React.useState(false);\r\n\r\n    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (focus) {\r\n            setInputValue(e.target.value);\r\n        }\r\n    };\r\n\r\n    const onInputBlur = (e: React.FocusEvent) => {\r\n        if (inputValue !== props.value)\r\n            props.onChange(inputValue);\r\n        setFocus(false);\r\n    };\r\n\r\n    const onInputFocus = (e: React.FocusEvent) => {\r\n        if (inputValue !== props.value) {\r\n            setInputValue(props.value);\r\n        }\r\n        setFocus(true);\r\n    };\r\n\r\n    const onKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter') {\r\n            if (inputValue !== props.value)\r\n                props.onChange(inputValue);\r\n        }\r\n    };\r\n\r\n    return <input className=\"string-input\" value={focus? inputValue: props.value} size={20}\r\n            onChange={onInputChange} onBlur={onInputBlur} onFocus={onInputFocus} onKeyDown={onKeyDown}\r\n        />;\r\n};\r\n","import * as React from \"react\";\r\nimport {Euler, Object3D, Vector3} from \"three\";\r\nimport {Vector3Editor} from \"./editors/Vector3Editor\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {StringInput} from \"./editors/StringInput\";\r\n\r\n\r\ninterface ObjectPropertiesProps {\r\n    object3d: Object3D,\r\n    updateProperties: Function,\r\n}\r\n\r\ninterface ObjectPropertiesState {\r\n\r\n}\r\n\r\nexport class ObjectProperties extends React.PureComponent<ObjectPropertiesProps, ObjectPropertiesState> {\r\n    constructor(props: Readonly<ObjectPropertiesProps>) {\r\n        super(props);\r\n    }\r\n\r\n    onChangeName = (name: string) => {\r\n        this.props.object3d.name = name;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangePosition = (x: number, y: number, z: number) => {\r\n        this.props.object3d.position.set(x, y, z);\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeScale = (x: number, y: number, z: number) => {\r\n        this.props.object3d.scale.set(x, y, z);\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeRotation = (x: number, y: number, z: number) => {\r\n        this.props.object3d.rotation.set(x, y, z);\r\n        this.props.updateProperties();\r\n    };\r\n\r\n    render() {\r\n        console.log('rendered objectProperties');\r\n        return (\r\n            <div>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <div className=\"property\">\r\n                            <label className=\"name\">Name:</label>\r\n                            <StringInput value={this.props.object3d.name} onChange={this.onChangeName}/>\r\n                        </div>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <Vector3Editor name=\"Position\" x={this.props.object3d.position.x}\r\n                                       y={this.props.object3d.position.y} z={this.props.object3d.position.z}\r\n                                       onChange={this.onChangePosition}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <Vector3Editor name=\"Rotation\" x={this.props.object3d.rotation.x}\r\n                                       y={this.props.object3d.rotation.y} z={this.props.object3d.rotation.z}\r\n                                       onChange={this.onChangeRotation} unitConversion={180 / Math.PI}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <Vector3Editor name=\"Scale\" x={this.props.object3d.scale.x}\r\n                                       y={this.props.object3d.scale.y} z={this.props.object3d.scale.z}\r\n                                       onChange={this.onChangeScale}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {ColorResult, SketchPicker} from \"react-color\";\r\nimport {Vector4} from \"three\";\r\nimport \"./ColorEditor.scss\";\r\n\r\ninterface ColorEditorProps {\r\n    color: Vector4;\r\n    onChange: (color: Vector4) => void;\r\n}\r\n\r\nfunction ConvertToColor(color: Vector4) {\r\n    return `rgba(${((color.x * 255) | 0)},${((color.y * 255) | 0)},${((color.z * 255) | 0)},${color.w})`;\r\n}\r\n\r\nexport const ColorEditor: React.FC<ColorEditorProps> = (props) => {\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    const togglePicker = () => {\r\n        setOpen(!open);\r\n    };\r\n\r\n    const closePicker = () => {\r\n        setOpen(false);\r\n    };\r\n\r\n    const colorChange = (colorResult: ColorResult) => {\r\n        const color = new Vector4();\r\n        color.x = Math.min(255, colorResult.rgb.r) / 255;\r\n        color.y = Math.min(255, colorResult.rgb.g) / 255;\r\n        color.z = Math.min(255, colorResult.rgb.b) / 255;\r\n        color.w = colorResult.rgb.a!;\r\n        onChange(color);\r\n    };\r\n\r\n    const {color, onChange} = props;\r\n\r\n    return (\r\n        <div className=\"color-editor\">\r\n            <button style={{backgroundColor: ConvertToColor(color), height: '20px'}} onClick={togglePicker}/>\r\n            {ConvertToColor(color)}\r\n            {\r\n                open ? <div className=\"popover\">\r\n                    <div className=\"cover\" onClick={closePicker}/>\r\n                    <SketchPicker\r\n                        color={{\r\n                            r: ((color.x * 255) | 0),\r\n                            g: ((color.y * 255) | 0),\r\n                            b: ((color.z * 255) | 0),\r\n                            a: color.w\r\n                        }}\r\n                        onChange={colorChange}/>\r\n                </div> : null\r\n            }\r\n        </div>);\r\n};\r\n","import React from \"react\";\r\n\r\nfunction interp(a: number, b: number, x: number) {\r\n    return a * (1 - x) + b * x;\r\n}\r\n\r\nexport interface TransformProps {\r\n    xFrom: number;\r\n    yFrom: number;\r\n    xTo: number;\r\n    yTo: number;\r\n}\r\n\r\nexport class TransformComponent<T extends TransformProps = TransformProps, K = {}> extends React.Component<T, K> {\r\n\r\n    x = (value: number) => interp(this.props.xFrom, this.props.xTo, value);\r\n    y = (value: number) => interp(this.props.yFrom, this.props.yTo, value);\r\n\r\n    shouldComponentUpdate(nextProps: TransformProps) {\r\n        const { xFrom, yFrom, xTo, yTo } = this.props;\r\n        return (\r\n            nextProps.xFrom !== xFrom ||\r\n            nextProps.yFrom !== yFrom ||\r\n            nextProps.xTo !== xTo ||\r\n            nextProps.yTo !== yTo\r\n        );\r\n    }\r\n}","import React from \"react\";\r\nimport {TransformComponent, TransformProps} from \"./TransformComponent\";\r\nimport {Bezier} from \"three.quarks\";\r\n\r\nexport interface CurveProps extends TransformProps {\r\n    curveColor: string;\r\n    curveWidth: number;\r\n    value: Bezier;\r\n}\r\n\r\nexport class CurveComponent extends TransformComponent<CurveProps> {\r\n    shouldComponentUpdate(nextProps: CurveProps) {\r\n        if (super.shouldComponentUpdate(nextProps)) return true;\r\n        const {\r\n            curveColor,\r\n            curveWidth,\r\n            value\r\n        } = this.props;\r\n        const [p0, p1, p2, p3] = value.p;\r\n        return nextProps.curveColor !== curveColor ||\r\n            nextProps.curveWidth !== curveWidth ||\r\n            nextProps.value !== value;\r\n    }\r\n\r\n    render() {\r\n        const {\r\n            curveColor,\r\n            curveWidth,\r\n            value\r\n        } = this.props;\r\n        const {x, y} = this;\r\n\r\n        const segments = Math.floor((x(1) - x(0)) / 5);\r\n\r\n        let curve = `M${x(0)},${y(value.genValue(0))} `;\r\n        if (segments > 0) {\r\n            for (let i = 1 / segments; i <= 1; i += 1 / segments) {\r\n                curve += `L${x(i)},${y(value.genValue(i))} `;\r\n            }\r\n        }\r\n        curve += `L${x(1)},${y(value.genValue(1))} `;\r\n\r\n        return (<path\r\n            fill=\"none\"\r\n            stroke={curveColor}\r\n            strokeWidth={curveWidth}\r\n            d={curve} />);\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport {TransformComponent, TransformProps} from \"./TransformComponent\";\r\n\r\ninterface HandleProps extends TransformProps {\r\n    handleRadius: number,\r\n    handleColor: string,\r\n    hover: boolean,\r\n    down: boolean,\r\n    background: string,\r\n    handleStroke: number,\r\n    xstart: number,\r\n    ystart: number,\r\n    xval: number,\r\n    yval: number,\r\n    onMouseEnter: (event: React.MouseEvent)=>void,\r\n    onMouseLeave: (event: React.MouseEvent)=>void,\r\n    onMouseDown: (event: React.MouseEvent)=>void,\r\n}\r\n\r\nexport class HandleComponent extends TransformComponent<HandleProps> {\r\n    shouldComponentUpdate(nextProps: HandleProps) {\r\n        if (super.shouldComponentUpdate(nextProps)) return true;\r\n        const {\r\n            xstart,\r\n            ystart,\r\n            handleRadius,\r\n            handleColor,\r\n            hover,\r\n            down,\r\n            background,\r\n            handleStroke,\r\n            xval,\r\n            yval,\r\n            onMouseEnter,\r\n            onMouseLeave,\r\n            onMouseDown\r\n        } = this.props;\r\n        return nextProps.xstart !== xstart ||\r\n            nextProps.ystart !== ystart ||\r\n            nextProps.handleRadius !== handleRadius ||\r\n            nextProps.handleColor !== handleColor ||\r\n            nextProps.hover !== hover ||\r\n            nextProps.down !== down ||\r\n            nextProps.background !== background ||\r\n            nextProps.handleStroke !== handleStroke ||\r\n            nextProps.xval !== xval ||\r\n            nextProps.yval !== yval ||\r\n            nextProps.onMouseDown !== onMouseDown ||\r\n            nextProps.onMouseLeave !== onMouseLeave ||\r\n            nextProps.onMouseEnter !== onMouseEnter;\r\n    }\r\n\r\n    render() {\r\n        const { x, y } = this;\r\n        const {\r\n            xstart,\r\n            ystart,\r\n            handleRadius,\r\n            handleColor,\r\n            hover,\r\n            down,\r\n            background,\r\n            handleStroke,\r\n            xval,\r\n            yval,\r\n            onMouseEnter,\r\n            onMouseLeave,\r\n            onMouseDown\r\n        } = this.props;\r\n\r\n        const sx = x(xstart);\r\n        const sy = y(ystart);\r\n        const cx = x(xval);\r\n        const cy = y(yval);\r\n        const a = Math.atan2(cy-sy, cx-sx);\r\n        const cxs = cx - handleRadius * Math.cos(a);\r\n        const cys = cy - handleRadius * Math.sin(a);\r\n\r\n        return <g>\r\n            <line\r\n                stroke={handleColor}\r\n                strokeWidth={hover||down ? 1 + handleStroke : handleStroke}\r\n                x1={cxs}\r\n                y1={cys}\r\n                x2={sx}\r\n                y2={sy} />\r\n            <circle\r\n                cx={cx}\r\n                cy={cy}\r\n                r={handleRadius}\r\n                stroke={handleColor}\r\n                strokeWidth={down ? 2 * handleStroke : handleStroke}\r\n                fill={down ? background: handleColor}\r\n                onMouseEnter={onMouseEnter}\r\n                onMouseLeave={onMouseLeave}\r\n                onMouseDown={onMouseDown} />\r\n        </g>;\r\n    }\r\n}","import * as React from \"react\";\r\nimport {CurveComponent} from \"./CurveComponent\";\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {HandleComponent} from \"./HandleComponent\";\r\nimport {createRef} from \"react\";\r\n\r\ninterface BezierCurvesEditorProps {\r\n    value: PiecewiseBezier\r\n    onChange?: (value:PiecewiseBezier) => void,\r\n    width: number,\r\n    height: number,\r\n    padding?: Array<number>,\r\n    className?: string,\r\n    background?: string,\r\n    gridColor?: string,\r\n    curveColor?: string,\r\n    handleColor?: string,\r\n    curveWidth?: number,\r\n    handleRadius?: number,\r\n    handleStroke?: number,\r\n    readOnly?: boolean,\r\n    style?: React.CSSProperties,\r\n    pointers?: React.CSSProperties,\r\n    textStyle?: React.CSSProperties,\r\n}\r\n\r\ninterface BezierCurvesEditorState {\r\n    curve: number,\r\n    hover: number,\r\n    down: number,\r\n}\r\n\r\nexport class BezierCurvesEditor extends React.Component<BezierCurvesEditorProps, BezierCurvesEditorState> {\r\n\r\n\r\n    static defaultP = {\r\n        padding: [0, 0, 0, 0],\r\n        handleRadius: 4,\r\n    }; //[25, 5, 25, 18]\r\n\r\n    constructor(props: Readonly<BezierCurvesEditorProps>) {\r\n        super(props);\r\n        this.state = {\r\n            curve: -1,\r\n            down: -1,\r\n            hover: -1,\r\n        };\r\n    }\r\n\r\n    rootRef = createRef<HTMLDivElement>();\r\n\r\n    positionForEvent = (e: React.MouseEvent) => {\r\n        if (this.rootRef.current) {\r\n            const rect = this.rootRef.current.getBoundingClientRect();\r\n            return [e.clientX - rect.left, e.clientY - rect.top];\r\n        } else {\r\n            return [0, 0];\r\n        }\r\n    };\r\n\r\n    x = (value:number) => {\r\n    };\r\n\r\n    y = (value:number) => {\r\n    };\r\n\r\n    inversex = (x:number) => {\r\n    };\r\n\r\n    inversey = (y:number) => {\r\n    };\r\n\r\n    onDownLeave = (e: React.MouseEvent) => {\r\n        if (this.state.down) {\r\n            this.onDownMove(e);\r\n            this.setState({\r\n                down: -1,\r\n                hover: -1\r\n            });\r\n        }\r\n    };\r\n    onDownMove = (e: React.MouseEvent) => {\r\n        if (this.state.down >= 0) {\r\n            e.preventDefault();\r\n            const [x, y] = this.positionForEvent(e);\r\n            const value = new PiecewiseBezier(this.props.value.functions);\r\n\r\n            const valueX = x / this.props.width;\r\n            const curveIndex = this.state.curve;\r\n            const curve = value.getFunction(curveIndex);\r\n\r\n            if (this.state.down === 0) {\r\n                const old = curve.p[0];\r\n                curve.p[0] = (this.props.height - y) / this.props.height;\r\n                curve.p[1] += curve.p[0] - old;\r\n                value.setStartX(curveIndex, x / this.props.width);\r\n                if (curveIndex - 1 >= 0) {\r\n                    const pCurve = value.getFunction(curveIndex - 1);\r\n                    pCurve.p[3] = (this.props.height - y) / this.props.height;\r\n                    pCurve.p[2] += curve.p[0] - old;\r\n                    value.setFunction(curveIndex - 1, value.getFunction(curveIndex - 1).clone());\r\n                }\r\n                value.setFunction(curveIndex, curve.clone());\r\n            }\r\n            if (this.state.down === 3) {\r\n                const old = curve.p[3];\r\n                curve.p[3] = (this.props.height - y) / this.props.height;\r\n                curve.p[2] += curve.p[3] - old;\r\n                value.setEndX(curveIndex, x / this.props.width);\r\n                if (curveIndex + 1 < value.numOfFunctions) {\r\n                    const nCurve = value.getFunction(curveIndex + 1);\r\n                    nCurve.p[0] = (this.props.height - y) / this.props.height;\r\n                    nCurve.p[1] += curve.p[3] - old;\r\n                    value.setFunction(curveIndex + 1, value.getFunction(curveIndex + 1).clone());\r\n                }\r\n                value.setFunction(curveIndex, curve.clone());\r\n            }\r\n            if (this.state.down === 1) {\r\n                curve.p[1] = (this.props.height - y) / this.props.height;\r\n                value.setFunction(curveIndex, curve.clone());\r\n            }\r\n            if (this.state.down === 2) {\r\n                curve.p[2] = (this.props.height - y) / this.props.height;\r\n                value.setFunction(curveIndex, curve.clone());\r\n            }\r\n            //value[i] = this.inversex(x);\r\n            //value[i + 1] = this.inversey(y);\r\n            if (this.props.onChange)\r\n                this.props.onChange(value);\r\n        }\r\n    };\r\n\r\n    onDownUp = () => {\r\n        // this.onDownMove(e);\r\n        this.setState({\r\n            down: -1,\r\n        });\r\n    };\r\n\r\n\r\n    onEnterHandle(curve: number, h: number) {\r\n        if (!this.state.down) {\r\n            this.setState({\r\n                hover: h,\r\n                curve: curve,\r\n            });\r\n        }\r\n    }\r\n    onDownHandle(curve: number, h: number, e: React.MouseEvent) {\r\n        e.preventDefault();\r\n        this.setState({\r\n            hover: -1,\r\n            down: h,\r\n            curve: curve,\r\n        });\r\n    }\r\n\r\n    onLeaveHandle() {\r\n        if (!this.state.down) {\r\n            this.setState({\r\n                hover: -1,\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n\r\n        const {\r\n            width,\r\n            height,\r\n            value,\r\n            curveWidth = 1,\r\n            curveColor = \"#000\",\r\n            handleRadius = BezierCurvesEditor.defaultP.handleRadius,\r\n            handleColor = \"#f00\",\r\n            handleStroke = 1,\r\n            background = \"#fff\",\r\n        } = this.props;\r\n\r\n        const {\r\n            curve: curveIndex,\r\n            down,\r\n            hover\r\n        } = this.state;\r\n\r\n        const curves = [];\r\n        for (let i = 0; i < value.numOfFunctions; i ++) {\r\n            const x1 = value.getStartX(i);\r\n            const x2 = value.getEndX(i);\r\n            const curve = value.getFunction(i);\r\n            const slope0 = curve.getSlope(0);\r\n            const slope1 = curve.getSlope(1);\r\n\r\n            curves.push(\r\n                <g key={i}>\r\n                    <CurveComponent xFrom={x1 * width} xTo={x2 * width} yFrom={height} yTo={0}\r\n                        curveColor={curveColor} curveWidth={curveWidth} value={curve}/>\r\n                    <HandleComponent\r\n                        xFrom={x1 * width} xTo={x2 * width} yFrom={height} yTo={0}\r\n                        onMouseDown={(e)=>this.onDownHandle(i, 0, e)}\r\n                        onMouseEnter={(e)=>this.onEnterHandle(i, 0)}\r\n                        onMouseLeave={(e)=>this.onLeaveHandle()}\r\n                        xstart={0}\r\n                        ystart={curve.p[0]}\r\n                        xval={0}\r\n                        yval={curve.p[0]}\r\n                        handleRadius={handleRadius}\r\n                        handleColor={handleColor}\r\n                        down={curveIndex === i && down === 0}\r\n                        hover={curveIndex === i && hover === 0}\r\n                        handleStroke={handleStroke}\r\n                        background={background}\r\n                    />\r\n                    <HandleComponent\r\n                        xFrom={x1 * width} xTo={x2 * width} yFrom={height} yTo={0}\r\n                        onMouseDown={(e)=>this.onDownHandle(i, 1, e)}\r\n                        onMouseEnter={(e)=>this.onEnterHandle(i, 1)}\r\n                        onMouseLeave={(e)=>this.onLeaveHandle()}\r\n                        xstart={0}\r\n                        ystart={curve.p[0]}\r\n                        xval={1.0 / 3}\r\n                        yval={1.0 / 3 * slope0 + curve.p[0]}\r\n                        handleRadius={handleRadius}\r\n                        handleColor={handleColor}\r\n                        down={curveIndex === i && down === 1}\r\n                        hover={curveIndex === i && hover === 1}\r\n                        handleStroke={handleStroke}\r\n                        background={background}\r\n                    />\r\n                    <HandleComponent\r\n                        xFrom={x1 * width} xTo={x2 * width} yFrom={height} yTo={0}\r\n                        onMouseDown={(e)=>this.onDownHandle(i, 2, e)}\r\n                        onMouseEnter={(e)=>this.onEnterHandle(i, 2)}\r\n                        onMouseLeave={(e)=>this.onLeaveHandle()}\r\n                        xstart={1}\r\n                        ystart={curve.p[3]}\r\n                        xval={1 - 1.0 / 3}\r\n                        yval={curve.p[3] - 1.0 / 3 * slope1}\r\n                        handleRadius={handleRadius}\r\n                        handleColor={handleColor}\r\n                        down={curveIndex === i && down === 2}\r\n                        hover={curveIndex === i && hover === 2}\r\n                        handleStroke={handleStroke}\r\n                        background={background}\r\n                    />\r\n                    <HandleComponent\r\n                        xFrom={x1 * width} xTo={x2 * width} yFrom={height} yTo={0}\r\n                        onMouseDown={(e)=>this.onDownHandle(i, 3, e)}\r\n                        onMouseEnter={(e)=>this.onEnterHandle(i, 3)}\r\n                        onMouseLeave={(e)=>this.onLeaveHandle()}\r\n                        xstart={1}\r\n                        ystart={curve.p[3]}\r\n                        xval={1}\r\n                        yval={curve.p[3]}\r\n                        handleRadius={handleRadius}\r\n                        handleColor={handleColor}\r\n                        down={curveIndex === i && down === 3}\r\n                        hover={curveIndex === i && hover === 3}\r\n                        handleStroke={handleStroke}\r\n                        background={background}\r\n                    />\r\n                </g>);\r\n        }\r\n        return <div ref={this.rootRef}\r\n                    onMouseMove={this.onDownMove}\r\n                    onMouseUp={this.onDownUp}\r\n                    onMouseLeave={this.onDownLeave}>\r\n            <svg width={width} height={height}>\r\n                {curves}\r\n            </svg>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport {FunctionValueGenerator, ValueGenerator} from \"three.quarks\";\r\nimport {ColorGenerator, ConstantColor, FunctionColorGenerator} from \"three.quarks\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {Vector4} from \"three\";\r\nimport {IntervalValue} from \"three.quarks\";\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {ColorRange} from \"three.quarks\";\r\nimport {RandomColor} from \"three.quarks\";\r\nimport {Gradient} from \"three.quarks\";\r\nimport {NumberInput} from \"./NumberInput\";\r\nimport {ColorEditor} from \"./ColorEditor\";\r\nimport \"./GeneratorEditor.scss\";\r\nimport {BezierCurvesEditor} from \"./bezier/BezierCurvesEditor\";\r\n\r\ntype EditorType =\r\n    'constant'\r\n    | 'intervalValue'\r\n    | 'piecewiseBezier'\r\n    | 'color'\r\n    | 'randomColor'\r\n    | 'colorRange'\r\n    | 'gradient';\r\nexport type ValueType = 'value' | 'functionValue' | 'color' | 'functionColor';\r\n\r\nconst ValueToEditor: { [a: string]: Array<EditorType> } = {\r\n    'value': ['constant', 'intervalValue'],\r\n    'functionValue': ['piecewiseBezier'],\r\n    'color': ['color', 'randomColor'],\r\n    'functionColor': ['colorRange', 'gradient'],\r\n};\r\n\r\nexport type GenericGenerator = ValueGenerator | FunctionValueGenerator | ColorGenerator | FunctionColorGenerator;\r\n\r\ninterface GeneratorEditorProps {\r\n    allowedType: Array<ValueType>;\r\n    name: string;\r\n    generator: GenericGenerator;\r\n    updateGenerator: (generator: GenericGenerator) => void;\r\n}\r\n\r\ninterface GeneratorEditorState {\r\n    open: boolean;\r\n}\r\n\r\nexport class GeneratorEditor extends React.PureComponent<GeneratorEditorProps, GeneratorEditorState> {\r\n\r\n    constructor(props: Readonly<GeneratorEditorProps>) {\r\n        super(props);\r\n        const currentEditor = ValueToEditor[props.allowedType[0]][0];\r\n        this.state = {\r\n            open: false,\r\n        }\r\n    }\r\n    changeEditor = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n        const editorType = e.target.value;\r\n        let generator: GenericGenerator | null = null;\r\n        switch(editorType) {\r\n            case \"constant\":\r\n                generator = new ConstantValue(0);\r\n                break;\r\n            case \"color\":\r\n                generator = new ConstantColor(new Vector4(1,1,1,1));\r\n                break;\r\n            case \"intervalValue\":\r\n                generator = new IntervalValue(0, 1);\r\n                break;\r\n            case \"colorRange\":\r\n                generator = new ColorRange(new Vector4(0,0,0,1), new Vector4(1,1,1,1));\r\n                break;\r\n            case \"randomColor\":\r\n                generator = new RandomColor(new Vector4(0,0,0,1), new Vector4(1,1,1,1));\r\n                break;\r\n        }\r\n        if (generator)\r\n            this.props.updateGenerator(generator);\r\n    }\r\n\r\n    changeValue = (x: number) => {\r\n        this.props.updateGenerator(new ConstantValue(x));\r\n    };\r\n\r\n    changeColor = (x: Vector4) => {\r\n        this.props.updateGenerator(new ConstantColor(x));\r\n    };\r\n\r\n    changeValueA = (x: number) => {\r\n        const interval = this.props.generator as IntervalValue;\r\n        this.props.updateGenerator(new IntervalValue(x, interval.b));\r\n    };\r\n\r\n    changeValueB = (x: number) => {\r\n        const interval = this.props.generator as IntervalValue;\r\n        this.props.updateGenerator(new IntervalValue(interval.a, x));\r\n    };\r\n\r\n    changeColorRangeA = (x: Vector4) => {\r\n        const colorRange = this.props.generator as ColorRange;\r\n        this.props.updateGenerator(new ColorRange(x, colorRange.b));\r\n    };\r\n    changeColorRangeB = (x: Vector4) => {\r\n        const colorRange = this.props.generator as ColorRange;\r\n        this.props.updateGenerator(new ColorRange(colorRange.a, x));\r\n    };\r\n    changeRandomColorA = (x: Vector4) => {\r\n        const randomColor = this.props.generator as RandomColor;\r\n        this.props.updateGenerator(new RandomColor(x, randomColor.b));\r\n    };\r\n    changeRandomColorB = (x: Vector4) => {\r\n        const randomColor = this.props.generator as RandomColor;\r\n        this.props.updateGenerator(new RandomColor(randomColor.a, x));\r\n    };\r\n\r\n    changeCurve = (x: PiecewiseBezier) => {\r\n        this.props.updateGenerator(new PiecewiseBezier(x.functions));\r\n    }\r\n\r\n    getEditorType(generator: GenericGenerator): EditorType {\r\n        if (generator instanceof ConstantValue) {\r\n            return 'constant';\r\n        } else if (generator instanceof IntervalValue) {\r\n            return 'intervalValue';\r\n        } else if (generator instanceof PiecewiseBezier) {\r\n            return 'piecewiseBezier';\r\n        } else if (generator instanceof ConstantColor) {\r\n            return 'color';\r\n        } else if (generator instanceof RandomColor) {\r\n            return 'randomColor';\r\n        } else if (generator instanceof ColorRange) {\r\n            return 'colorRange';\r\n        } else if (generator instanceof Gradient) {\r\n            return 'gradient';\r\n        }\r\n        return 'constant';\r\n    }\r\n\r\n    render() {\r\n        console.log('render GeneratorEditor');\r\n        const {name, generator, allowedType} = this.props;\r\n\r\n        const editorTypes = [];\r\n        for (const valueType of allowedType) {\r\n            console.log(valueType);\r\n            console.log(ValueToEditor[valueType]);\r\n            for (const editorType of ValueToEditor[valueType]) {\r\n                editorTypes.push(editorType);\r\n            }\r\n        }\r\n\r\n        const currentEditor = this.getEditorType(generator);\r\n\r\n        let editor;\r\n        switch (currentEditor) {\r\n            case \"constant\":\r\n                editor = <React.Fragment>\r\n                    <NumberInput value={(generator as ConstantValue).value}\r\n                                 onChange={this.changeValue}/></React.Fragment>;\r\n                break;\r\n            case \"color\":\r\n                editor = (<React.Fragment>\r\n                    <ColorEditor color={(generator as ConstantColor).color} onChange={this.changeColor}/>\r\n                </React.Fragment>);\r\n                break;\r\n            case \"intervalValue\":\r\n                editor = <React.Fragment>\r\n                    <NumberInput value={(generator as IntervalValue).a}\r\n                                 onChange={this.changeValueA}/>-<NumberInput\r\n                    value={(generator as IntervalValue).b} onChange={this.changeValueB}/></React.Fragment>;\r\n                break;\r\n            case \"piecewiseBezier\":\r\n                editor = <React.Fragment>\r\n                    <BezierCurvesEditor height={40} width={240} value={(generator as PiecewiseBezier)} onChange={this.changeCurve}/>\r\n                </React.Fragment>;\r\n                break;\r\n            case \"colorRange\":\r\n                editor = (<React.Fragment>\r\n                    <ColorEditor color={(generator as ColorRange).a} onChange={this.changeColorRangeA}/>-\r\n                    <ColorEditor color={(generator as ColorRange).b} onChange={this.changeColorRangeB}/>\r\n                </React.Fragment>);\r\n                break;\r\n            case \"randomColor\":\r\n                editor = (<React.Fragment>\r\n                    <ColorEditor color={(generator as RandomColor).a} onChange={this.changeRandomColorA}/>-\r\n                    <ColorEditor color={(generator as RandomColor).b} onChange={this.changeRandomColorB}/>\r\n                </React.Fragment>);\r\n                break;\r\n        }\r\n        return <div className=\"property\">\r\n            <label className=\"name\">{name}</label>\r\n            {editor}\r\n            <select className=\"editor-select\" onChange={this.changeEditor}>\r\n                {editorTypes.map(editorType => <option key={editorType} value={editorType} selected={currentEditor === editorType}>{editorType}</option>)}\r\n            </select>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {GeneratorEditor, GenericGenerator, ValueType} from \"./editors/GeneratorEditor\";\r\nimport {ParticleSystem} from \"three.quarks\";\r\nimport {FunctionValueGenerator, ValueGenerator} from \"three.quarks\";\r\nimport {ColorGenerator, FunctionColorGenerator} from \"three.quarks\";\r\n\r\ninterface ParticleSystemPropertiesProps {\r\n    particleSystem: ParticleSystem,\r\n    updateProperties: Function,\r\n}\r\n\r\ninterface ParticleSystemPropertiesState {\r\n\r\n}\r\n\r\nexport class ParticleSystemProperties extends React.PureComponent<ParticleSystemPropertiesProps, ParticleSystemPropertiesState> {\r\n    constructor(props: Readonly<ParticleSystemPropertiesProps>) {\r\n        super(props);\r\n    }\r\n    onChangeStartSpeed = (g: GenericGenerator) => {\r\n        console.log(\"change start speed\");\r\n        this.props.particleSystem.startSpeed = g as ValueGenerator | FunctionValueGenerator;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeStartLife = (g: GenericGenerator) => {\r\n        console.log(\"change start life\");\r\n        this.props.particleSystem.startLife = g as ValueGenerator | FunctionValueGenerator;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeStartSize = (g: GenericGenerator) => {\r\n        console.log(\"change start size\");\r\n        this.props.particleSystem.startSize = g as ValueGenerator | FunctionValueGenerator;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeStartColor = (g: GenericGenerator) => {\r\n        console.log(\"change start color\");\r\n        this.props.particleSystem.startColor = g as ColorGenerator | FunctionColorGenerator;\r\n        this.props.updateProperties();\r\n    };\r\n    OnChangeStartRotation = (g: GenericGenerator) => {\r\n        console.log(\"change start rotation\");\r\n        this.props.particleSystem.startRotation = g as ValueGenerator | FunctionValueGenerator;\r\n        this.props.updateProperties();\r\n    };\r\n    OnChangeEmissionOverTime = (g: GenericGenerator) => {\r\n        console.log(\"change start rotation\");\r\n        this.props.particleSystem.emissionOverTime = g as ValueGenerator | FunctionValueGenerator;\r\n        this.props.updateProperties();\r\n    };\r\n\r\n    render() {\r\n        console.log('rendered objectProperties');\r\n        const valueFunctionTypes = ['value', 'functionValue'] as Array<ValueType>;\r\n        const colorValueFunctionTypes = ['color', 'functionColor'] as Array<ValueType>;\r\n        return (\r\n            <div>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <GeneratorEditor name=\"Start Life\"\r\n                                         allowedType={valueFunctionTypes}\r\n                                         generator={this.props.particleSystem.startLife}\r\n                                         updateGenerator={this.onChangeStartLife}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <GeneratorEditor name=\"Start Size\"\r\n                                         allowedType={valueFunctionTypes}\r\n                                         generator={this.props.particleSystem.startSize}\r\n                                         updateGenerator={this.onChangeStartSize}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <GeneratorEditor name=\"Start Speed\"\r\n                                         allowedType={valueFunctionTypes}\r\n                                         generator={this.props.particleSystem.startSpeed}\r\n                                         updateGenerator={this.onChangeStartSpeed}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <GeneratorEditor name=\"Start Color\"\r\n                                         allowedType={colorValueFunctionTypes}\r\n                                         generator={this.props.particleSystem.startColor}\r\n                                         updateGenerator={this.onChangeStartColor}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <GeneratorEditor name=\"Start Rotation\"\r\n                                         allowedType={valueFunctionTypes}\r\n                                         generator={this.props.particleSystem.startRotation}\r\n                                         updateGenerator={this.OnChangeStartRotation}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <GeneratorEditor name=\"Emission Over Time\"\r\n                                         allowedType={valueFunctionTypes}\r\n                                         generator={this.props.particleSystem.emissionOverTime}\r\n                                         updateGenerator={this.OnChangeEmissionOverTime}/>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from \"react\";\r\n\r\n\r\ninterface FileInputProps {\r\n    fileName: string\r\n    onChange: (files: FileList) => void;\r\n}\r\n\r\nexport class FileInput extends React.Component<FileInputProps>\r\n{\r\n    constructor(props: any)\r\n    {\r\n        super(props);\r\n    }\r\n\r\n    handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files)\r\n            this.props.onChange(e.target.files);\r\n    };\r\n\r\n    render ()\r\n    {\r\n        return <div>\r\n            <input type=\"file\" onChange={this.handleChange} />\r\n            {this.props.fileName}\r\n        </div>;\r\n    }\r\n}","import * as React from \"react\";\r\nimport {AdditiveBlending, Blending, NormalBlending, Texture} from \"three\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {GeneratorEditor, GenericGenerator, ValueType} from \"./editors/GeneratorEditor\";\r\nimport {ParticleSystem} from \"three.quarks\";\r\nimport {NumberInput} from \"./editors/NumberInput\";\r\nimport {FileInput} from \"./editors/FileInput\";\r\n\r\n\r\ninterface ParticleRendererPropertiesProps {\r\n    particleSystem: ParticleSystem,\r\n    updateProperties: Function,\r\n}\r\n\r\ninterface ParticleRendererPropertiesState {\r\n\r\n}\r\n\r\nexport class ParticleRendererProperties extends React.PureComponent<ParticleRendererPropertiesProps, ParticleRendererPropertiesState> {\r\n    constructor(props: Readonly<ParticleRendererPropertiesProps>) {\r\n        super(props);\r\n    }\r\n\r\n    onChangeTexture = (files: FileList) => {\r\n        console.log(\"change texture\");\r\n        const image = document.createElement( 'img' );\r\n        const texture = new Texture( image );\r\n        image.onload = function()  {\r\n            texture.needsUpdate = true;\r\n        };\r\n\r\n        if (files && files[0]) {\r\n            const reader = new FileReader();\r\n            reader.onload = function (e) {\r\n                image.src = reader.result as string;\r\n            };\r\n            reader.readAsDataURL(files[0]);\r\n        }\r\n        this.props.particleSystem.texture = texture;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeStartTile = (index: number) => {\r\n        this.props.particleSystem.startTileIndex = index;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeUTileCount = (u: number) => {\r\n        this.props.particleSystem.uTileCount = u;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeVTileCount = (v: number) => {\r\n        this.props.particleSystem.vTileCount = v;\r\n        this.props.updateProperties();\r\n    };\r\n    onChangeBlending = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n        console.log(e.target.value);\r\n        switch (e.target.value) {\r\n            case \"Normal\":\r\n                this.props.particleSystem.blending = NormalBlending;\r\n                this.props.particleSystem.emitter.material.blending = NormalBlending;\r\n                break;\r\n            case \"Additive\":\r\n                this.props.particleSystem.blending = AdditiveBlending;\r\n                this.props.particleSystem.emitter.material.blending = AdditiveBlending;\r\n                break;\r\n        }\r\n        this.props.updateProperties();\r\n    }\r\n\r\n    getValueOfBlending = (blending: Blending) => {\r\n        switch (blending) {\r\n            case NormalBlending:\r\n                return \"Normal\"\r\n            case AdditiveBlending:\r\n                return \"Additive\";\r\n        }\r\n    }\r\n\r\n    render() {\r\n        console.log('rendered particleRendererProperties');\r\n        return (\r\n            <div>\r\n\r\n                texture?: Texture;\r\n                blending?: Blending;\r\n                worldSpace?: boolean;\r\n\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <div className=\"property\">\r\n                            <label className=\"name\">Blend Mode</label>\r\n                            <select className=\"editor-select\" onChange={this.onChangeBlending} value={this.getValueOfBlending(this.props.particleSystem.blending)}>\r\n                                <option key={0} value=\"Normal\" >Normal</option>\r\n                                <option key={1} value=\"Additive\" >Additive</option>\r\n                            </select>\r\n                        </div>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <div className=\"property\">\r\n                            <label className=\"name\">UVTile</label>\r\n                            <label>Column:</label><NumberInput value={this.props.particleSystem.uTileCount} onChange={this.onChangeUTileCount}/>\r\n                            <label>Row:</label><NumberInput value={this.props.particleSystem.vTileCount} onChange={this.onChangeVTileCount}/>\r\n                        </div>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <div className=\"property\">\r\n                            <label className=\"name\">Start Tile Index</label><NumberInput value={this.props.particleSystem.startTileIndex} onChange={this.onChangeStartTile}/>\r\n                        </div>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <div className=\"property\">\r\n                            <label className=\"name\">Texture</label>\r\n                            <FileInput fileName={this.props.particleSystem.texture? this.props.particleSystem.texture.name: \"..\"} onChange={this.onChangeTexture} />\r\n                        </div>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport Editor from 'react-simple-code-editor';\r\nimport { highlight, languages } from 'prismjs';\r\nimport \"./ScriptEditor.scss\";\r\n\r\ninterface ScriptEditorProps{\r\n    value: string;\r\n    onChange: (value: string)=>void;\r\n}\r\n\r\nexport const ScriptEditor : React.FC<ScriptEditorProps> = (props) => {\r\n\r\n    const [inputValue, setInputValue] = React.useState(props.value);\r\n    const [focus, setFocus] = React.useState(false);\r\n\r\n    const onInputChange = (value: string) => {\r\n        if (focus) {\r\n            setInputValue(value);\r\n        }\r\n    };\r\n\r\n    const onInputBlur = (e: React.FocusEvent) => {\r\n        if (inputValue !== props.value)\r\n            props.onChange(inputValue);\r\n        setFocus(false);\r\n    };\r\n\r\n    const onInputFocus = (e: React.FocusEvent) => {\r\n        if (inputValue !== props.value) {\r\n            setInputValue(props.value);\r\n        }\r\n        setFocus(true);\r\n    };\r\n\r\n    const onKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter') {\r\n            if (inputValue !== props.value)\r\n                props.onChange(inputValue);\r\n        }\r\n    };\r\n\r\n    return(\r\n        <Editor\r\n            value={focus? inputValue: props.value}\r\n            onValueChange={onInputChange}\r\n            highlight={code => highlight(code, languages.javascript, \"javascript\")}\r\n            padding={10}\r\n            onBlur={onInputBlur} onFocus={onInputFocus} //onKeyDown={onKeyDown}\r\n            style={{\r\n                fontFamily: '\"Consolas\", monospace',\r\n                fontSize: 12,\r\n            }}\r\n        />);\r\n};\r\n","import * as React from \"react\";\r\nimport {Euler, Object3D, Vector3} from \"three\";\r\nimport {Vector3Editor} from \"./editors/Vector3Editor\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {StringInput} from \"./editors/StringInput\";\r\nimport {ScriptEditor} from \"./editors/ScriptEditor\";\r\n\r\ninterface ScriptPropertiesProps {\r\n    object3d: Object3D,\r\n    updateProperties: Function,\r\n}\r\n\r\ninterface ScriptPropertiesState {\r\n\r\n}\r\n\r\nexport class ScriptProperties extends React.PureComponent<ScriptPropertiesProps, ScriptPropertiesState> {\r\n    constructor(props: Readonly<ScriptPropertiesProps>) {\r\n        super(props);\r\n    }\r\n\r\n    onChangeScript = (script: string) => {\r\n        if (this.props.object3d.userData === null) {\r\n            this.props.object3d.userData = {};\r\n        }\r\n        this.props.object3d.userData.script = script;\r\n        this.props.object3d.userData.func = new Function(\"delta\", script);\r\n        this.props.updateProperties();\r\n    };\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <div className=\"property\">\r\n                        <label className=\"script\">Script:</label>\r\n                        <ScriptEditor value={this.props.object3d.userData.script || \"\"} onChange={this.onChangeScript}/>\r\n                        </div>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import {Blending, Texture} from \"three\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {GeneratorEditor, GenericGenerator, ValueType} from \"./editors/GeneratorEditor\";\r\nimport {ConeEmitter, DonutEmitter, EmitterShape, ParticleSystem, PointEmitter, SphereEmitter} from \"three.quarks\";\r\nimport {NumberInput} from \"./editors/NumberInput\";\r\nimport {FileInput} from \"./editors/FileInput\";\r\nimport React, {ChangeEvent} from \"react\";\r\n\r\n\r\ninterface EmitterShapePropertiesProps {\r\n    particleSystem: ParticleSystem,\r\n    updateProperties: Function,\r\n}\r\n\r\ninterface EmitterShapePropertiesState {\r\n\r\n}\r\n\r\nexport class EmitterShapeProperties extends React.PureComponent<EmitterShapePropertiesProps, EmitterShapePropertiesState> {\r\n    constructor(props: Readonly<EmitterShapePropertiesProps>) {\r\n        super(props);\r\n    }\r\n\r\n    getValueOfShape = (shape: EmitterShape) => {\r\n        if (this.props.particleSystem.emitterShape instanceof PointEmitter) {\r\n            return \"PointEmitter\";\r\n        } else if (this.props.particleSystem.emitterShape instanceof ConeEmitter) {\r\n            return \"ConeEmitter\";\r\n        } else if (this.props.particleSystem.emitterShape instanceof SphereEmitter) {\r\n            return \"SphereEmitter\";\r\n        } else if (this.props.particleSystem.emitterShape instanceof DonutEmitter) {\r\n            return \"DonutEmitter\";\r\n        } else\r\n            return \"\";\r\n    };\r\n\r\n    onChangeShape = (e: ChangeEvent<HTMLSelectElement>) => {\r\n        switch (e.target.value) {\r\n            case \"PointEmitter\":\r\n                if (!(this.props.particleSystem.emitterShape instanceof PointEmitter)) {\r\n                    this.props.particleSystem.emitterShape = new PointEmitter();\r\n                    this.props.updateProperties();\r\n                }\r\n                break;\r\n            case \"ConeEmitter\":\r\n                if (!(this.props.particleSystem.emitterShape instanceof ConeEmitter)) {\r\n                    this.props.particleSystem.emitterShape = new ConeEmitter();\r\n                    this.props.updateProperties();\r\n                }\r\n                break;\r\n            case \"SphereEmitter\":\r\n                if (!(this.props.particleSystem.emitterShape instanceof SphereEmitter)) {\r\n                    this.props.particleSystem.emitterShape = new SphereEmitter();\r\n                    this.props.updateProperties();\r\n                }\r\n                break;\r\n            case \"DonutEmitter\":\r\n                if (!(this.props.particleSystem.emitterShape instanceof DonutEmitter)) {\r\n                    this.props.particleSystem.emitterShape = new DonutEmitter();\r\n                    this.props.updateProperties();\r\n                }\r\n                break;\r\n        }\r\n    };\r\n\r\n    onChangeKeyValue = (k: string, v: number) => {\r\n        (this.props.particleSystem.emitterShape as any)[k] = v;\r\n        this.props.updateProperties();\r\n    };\r\n\r\n    renderShapeProperties() {\r\n        const properties = [];\r\n        for (const key in this.props.particleSystem.emitterShape) {\r\n            properties.push(\r\n                <div key={key} className=\"property\">\r\n                    <label className=\"name\">{key}:</label>\r\n                    <NumberInput value={(this.props.particleSystem.emitterShape as any)[key]} onChange={(value) => this.onChangeKeyValue(key, value)}/>\r\n                </div>\r\n            );\r\n        }\r\n        return properties;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                        <div className=\"property\">\r\n                            <label className=\"name\">Shape</label>\r\n                            <select className=\"editor-select\" onChange={this.onChangeShape} value={this.getValueOfShape(this.props.particleSystem.emitterShape)}>\r\n                                <option key={0} value=\"PointEmitter\" >PointEmitter</option>\r\n                                <option key={1} value=\"ConeEmitter\" >ConeEmitter</option>\r\n                                <option key={2} value=\"SphereEmitter\" >SphereEmitter</option>\r\n                                <option key={3} value=\"DonutEmitter\" >DonutEmitter</option>\r\n                            </select>\r\n                        </div>\r\n                    }\r\n                </ApplicationContextConsumer>\r\n                <ApplicationContextConsumer>\r\n                    {context => context && this.renderShapeProperties()}\r\n                </ApplicationContextConsumer>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {\r\n    ParticleSystem,\r\n    ParticleEmitter\r\n} from \"three.quarks\";\r\nimport {Object3D} from \"three\";\r\nimport {ButtonGroup} from \"@material-ui/core\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\r\n\r\ninterface ParticleSystemControllerProps {\r\n    object3d: Object3D,\r\n    updateProperties: Function,\r\n}\r\n\r\ninterface ParticleSystemControllerState {\r\n\r\n}\r\n\r\nexport class ParticleSystemController extends React.PureComponent<ParticleSystemControllerProps, ParticleSystemControllerState> {\r\n    constructor(props: Readonly<ParticleSystemControllerProps>) {\r\n        super(props);\r\n    }\r\n\r\n    getSystems = () => {\r\n        const systems: Array<ParticleSystem> = [];\r\n        if (this.props.object3d instanceof ParticleEmitter) {\r\n            systems.push(this.props.object3d.system);\r\n        }\r\n        this.props.object3d.traverse(object => {\r\n            if (object instanceof ParticleEmitter) {\r\n                systems.push(object.system);\r\n            }\r\n        });\r\n        return systems;\r\n    };\r\n\r\n    checkPause = (systems: Array<ParticleSystem>) => {\r\n        let paused = true;\r\n        systems.forEach(system => {\r\n            if (!system.paused) {\r\n                paused = false;\r\n            }\r\n        });\r\n        return paused;\r\n    };\r\n\r\n    togglePause = () => {\r\n        const systems: Array<ParticleSystem> = this.getSystems();\r\n        const paused = this.checkPause(systems);\r\n\r\n        if (paused) {\r\n            systems.forEach(system => {\r\n                system.play();\r\n            });\r\n        } else {\r\n            systems.forEach(system => {\r\n                system.pause();\r\n            });\r\n        }\r\n        this.props.updateProperties();\r\n    };\r\n\r\n    onRestart = () => {\r\n        this.getSystems().forEach((system) => {\r\n            system.restart();\r\n        });\r\n        this.props.updateProperties();\r\n    };\r\n\r\n    onStop = () => {\r\n        this.getSystems().forEach((system) => {\r\n            system.restart();\r\n            system.pause();\r\n        });\r\n        this.props.updateProperties();\r\n    };\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <ToggleButtonGroup color=\"primary\" aria-label=\"primary button group\">\r\n                </ToggleButtonGroup>\r\n                <ApplicationContextConsumer>\r\n                    {context => context &&\r\n                    <ButtonGroup color=\"primary\" aria-label=\"primary button group\">\r\n                        <Button disabled={!this.checkPause(this.getSystems())} onClick={this.togglePause}>Play</Button>\r\n                        <Button disabled={this.checkPause(this.getSystems())} onClick={this.togglePause}>Pause</Button>\r\n                        <Button onClick={this.onRestart}>Restart</Button>\r\n                        <Button onClick={this.onStop}>Stop</Button>\r\n                    </ButtonGroup>}\r\n                </ApplicationContextConsumer>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from \"react\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {GeneratorEditor, GenericGenerator, ValueType} from \"./editors/GeneratorEditor\";\r\nimport {ColorOverLife, FrameOverLife, ParticleSystem, RotationOverLife, SizeOverLife} from \"three.quarks\";\r\nimport {FunctionValueGenerator, ValueGenerator} from \"three.quarks\";\r\nimport {ColorGenerator, FunctionColorGenerator} from \"three.quarks\";\r\nimport {ListItem, List, Theme, createStyles, Typography, Toolbar, ListItemIcon} from \"@material-ui/core\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\n\r\ninterface BehaviorsPropertiesProps {\r\n    particleSystem: ParticleSystem,\r\n    updateProperties: Function,\r\n}\r\n\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: '100%',\r\n        },\r\n        listRoot: {\r\n            width: '100%',\r\n            backgroundColor: theme.palette.background.paper,\r\n        }\r\n    }),\r\n);\r\n\r\n/*\r\n<GeneratorEditor name=\"Start Speed\"\r\n                 allowedType={valueFunctionTypes}\r\n                 generator={this.props.particleSystem.startSpeed}\r\n                 updateGenerator={this.onChangeStartSpeed}/>*/\r\n\r\nexport function BehaviorsProperties(props: BehaviorsPropertiesProps) {\r\n    const classes = useStyles();\r\n    const [checked, setChecked] = React.useState([0, 1, 2, 3]);\r\n    const [selectedIndex, setSelectedIndex] = React.useState(1);\r\n    const handleListItemClick = (event: any, index: number) => {\r\n        setSelectedIndex(index);\r\n    };\r\n\r\n    const valueFunctionTypes = ['value', 'functionValue'] as Array<ValueType>;\r\n    const colorValueFunctionTypes = ['color', 'functionColor'] as Array<ValueType>;\r\n    const onChangeStartColor = (g: GenericGenerator) => {\r\n        props.particleSystem.startColor = g as ColorGenerator | FunctionColorGenerator;\r\n        props.updateProperties();\r\n    };\r\n\r\n    const handleToggle = (value: number) => () => {\r\n        const currentIndex = checked.indexOf(value);\r\n        const newChecked = [...checked];\r\n\r\n        if (currentIndex === -1) {\r\n            newChecked.push(value);\r\n        } else {\r\n            newChecked.splice(currentIndex, 1);\r\n        }\r\n\r\n        setChecked(newChecked);\r\n    };\r\n\r\n    const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\r\n    const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n        setAnchorEl(event.currentTarget);\r\n    };\r\n    const handleClose = () => {\r\n        setAnchorEl(null);\r\n    };\r\n\r\n    const onChangeBehaviorFunc = (index: number) => (generator: GenericGenerator) => {\r\n        const behavior = props.particleSystem.behaviors[index];\r\n        switch (behavior.type) {\r\n            case 'ColorOverLife':\r\n                (behavior as ColorOverLife).func = generator as FunctionColorGenerator;\r\n                break;\r\n            case 'RotationOverLife':\r\n                (behavior as RotationOverLife).angularVelocityFunc = generator as FunctionValueGenerator | ValueGenerator;\r\n                break;\r\n            case 'SizeOverLife':\r\n                (behavior as SizeOverLife).func = generator as FunctionValueGenerator;\r\n                break;\r\n            case 'FrameOverLife':\r\n                (behavior as FrameOverLife).func = generator as FunctionValueGenerator;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        props.updateProperties();\r\n    }\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            <ButtonGroup color=\"primary\" aria-label=\"primary button group\">\r\n                <Button color=\"inherit\" aria-controls=\"simple-menu\"\r\n                        aria-haspopup=\"true\" onClick={handleClick} id=\"new-button\">\r\n                    New\r\n                </Button>\r\n                <Menu\r\n                    id=\"simple-menu\"\r\n                    anchorEl={anchorEl}\r\n                    keepMounted\r\n                    open={Boolean(anchorEl)}\r\n                    onClose={handleClose}\r\n                >\r\n                    <MenuItem onClick={handleClose}>SizeOverLife</MenuItem>\r\n                    <MenuItem onClick={handleClose}>ColorOverLife</MenuItem>\r\n                    <MenuItem onClick={handleClose}>RotationOverLife</MenuItem>\r\n                    <MenuItem onClick={handleClose}>FrameOverLife</MenuItem>\r\n                </Menu>\r\n                <Button>Remove</Button>\r\n            </ButtonGroup>\r\n            <ApplicationContextConsumer>\r\n                {context => context &&\r\n                    <List dense className={classes.listRoot}>\r\n                        {\r\n                            props.particleSystem.behaviors.map((behavior, index) => {\r\n                                const labelId = `behavior-list-label-${index}`;\r\n                                let valueTypes: Array<ValueType>;\r\n                                let func: FunctionColorGenerator | FunctionValueGenerator | ValueGenerator | null = null;\r\n                                switch (behavior.type) {\r\n                                    case 'ColorOverLife':\r\n                                        valueTypes = ['functionColor'];\r\n                                        func = (behavior as ColorOverLife).func;\r\n                                        break;\r\n                                    case 'RotationOverLife':\r\n                                        valueTypes = ['functionValue', 'value'];\r\n                                        func = (behavior as RotationOverLife).angularVelocityFunc;\r\n                                        break;\r\n                                    case 'SizeOverLife':\r\n                                        valueTypes = ['functionValue'];\r\n                                        func = (behavior as SizeOverLife).func;\r\n                                        break;\r\n                                    case 'FrameOverLife':\r\n                                        valueTypes = ['functionValue'];\r\n                                        func = (behavior as FrameOverLife).func;\r\n                                        break;\r\n                                    default:\r\n                                        valueTypes = ['functionValue'];\r\n                                        break;\r\n                                }\r\n\r\n                                let editor;\r\n                                if (func) {\r\n                                    editor =\r\n                                        <GeneratorEditor name=\"Func\"\r\n                                                         allowedType={valueTypes}\r\n                                                         generator={func}\r\n                                                         updateGenerator={onChangeBehaviorFunc(index)}/>;\r\n                                }\r\n\r\n                                return (\r\n                                    <ListItem key={index}\r\n                                              selected={selectedIndex === index}\r\n                                              onClick={(event) => handleListItemClick(event, index)}>\r\n                                        <ListItemIcon>\r\n                                            <Checkbox\r\n                                                edge=\"end\"\r\n                                                onChange={handleToggle(index)}\r\n                                                checked={checked.indexOf(index) !== -1}\r\n                                                inputProps={{'aria-labelledby': labelId}}\r\n                                            />\r\n                                        </ListItemIcon>\r\n                                        <ListItemText id={labelId} primary={behavior.type}\r\n                                                      secondary={editor}/>\r\n                                    </ListItem>\r\n                                );\r\n                            })\r\n                        }\r\n                    </List>\r\n                }\r\n            </ApplicationContextConsumer>\r\n        </div>\r\n    );\r\n}\r\n","import * as React from \"react\";\r\nimport {ConstantValue} from \"three.quarks\";\r\nimport {FunctionValueGenerator, ValueGenerator} from \"three.quarks\";\r\nimport {ColorGenerator, ConstantColor, FunctionColorGenerator} from \"three.quarks\";\r\nimport {Object3D, Vector4} from \"three\";\r\nimport {ObjectProperties} from \"./ObjectProperties\";\r\nimport {ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {ParticleEmitter} from \"three.quarks\";\r\nimport {ParticleSystemProperties} from \"./ParticleSystemProperties\";\r\nimport {ParticleRendererProperties} from \"./ParticleRendererProperties\";\r\nimport {ScriptProperties} from \"./ScriptProperties\";\r\nimport {EmitterShapeProperties} from \"./EmitterShapeProperties\";\r\nimport {ParticleSystemController} from \"./ParticleSystemController\";\r\nimport {createStyles, makeStyles, Theme} from \"@material-ui/core\";\r\nimport MuiAccordionSummary from \"@material-ui/core/AccordionSummary\";\r\nimport MuiAccordion from \"@material-ui/core/Accordion\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport AccordionDetails from \"@material-ui/core/AccordionDetails\";\r\nimport \"./PropertiesEditor.scss\";\r\nimport withStyles from \"@material-ui/core/styles/withStyles\";\r\nimport {BehaviorsProperties} from \"./BehaviorsProperties\";\r\n\r\nconst Accordion = withStyles({\r\n    root: {\r\n        border: '1px solid rgba(0, 0, 0, .125)',\r\n        boxShadow: 'none',\r\n        '&:not(:last-child)': {\r\n            borderBottom: 0,\r\n        },\r\n        '&:before': {\r\n            display: 'none',\r\n        },\r\n        '&$expanded': {\r\n            margin: 'auto',\r\n        },\r\n    },\r\n    expanded: {},\r\n})(MuiAccordion);\r\n\r\nconst AccordionSummary = withStyles({\r\n    root: {\r\n        backgroundColor: 'rgba(0, 0, 0, .03)',\r\n        borderBottom: '1px solid rgba(0, 0, 0, .125)',\r\n        marginBottom: -1,\r\n        minHeight: 32,\r\n        '&$expanded': {\r\n            minHeight: 32,\r\n        },\r\n    },\r\n    content: {\r\n        margin: 0,\r\n        '&$expanded': {\r\n            margin: 0,\r\n        },\r\n    },\r\n    expandIcon: {\r\n        padding: 0\r\n    },\r\n    expanded: {},\r\n})(MuiAccordionSummary);\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: '100%',\r\n        },\r\n        heading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n    }),\r\n);\r\n\r\ninterface PropertiesEditorProps {\r\n    object3d: Object3D\r\n}\r\n\r\nexport default function PropertiesEditor(props: PropertiesEditorProps) {\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.root}>\r\n            <Accordion>\r\n                <AccordionSummary\r\n                    expandIcon={<ExpandMoreIcon/>}\r\n                    aria-controls=\"object-content\"\r\n                    id=\"object-header\"\r\n                >\r\n                    <Typography className={classes.heading}>Object</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <ApplicationContextConsumer>\r\n                        {context => context &&\r\n                            <ObjectProperties object3d={props.object3d}\r\n                                              updateProperties={context.actions.updateProperties}/>\r\n                        }\r\n                    </ApplicationContextConsumer>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n            <Accordion>\r\n                <AccordionSummary\r\n                    expandIcon={<ExpandMoreIcon/>}\r\n                    aria-controls=\"particle-controller-content\"\r\n                    id=\"particle-controller-header\"\r\n                >\r\n                    <Typography className={classes.heading}>Particle Controller</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <ApplicationContextConsumer>\r\n                        {context => context &&\r\n                            <ParticleSystemController object3d={props.object3d}\r\n                                                      updateProperties={context.actions.updateProperties}/>\r\n                        }\r\n                    </ApplicationContextConsumer>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n            {(props.object3d instanceof ParticleEmitter) &&\r\n            <Accordion>\r\n                <AccordionSummary\r\n                    expandIcon={<ExpandMoreIcon/>}\r\n                    aria-controls=\"emitter-shape-content\"\r\n                    id=\"emitter-shape-header\">\r\n                    <Typography className={classes.heading}>Emitter Shape</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <ApplicationContextConsumer>\r\n                        {context => context &&\r\n                            <EmitterShapeProperties particleSystem={(props.object3d as ParticleEmitter).system}\r\n                                                    updateProperties={context.actions.updateProperties}/>\r\n                        }\r\n                    </ApplicationContextConsumer>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n            }\r\n            {(props.object3d instanceof ParticleEmitter) &&\r\n            <Accordion>\r\n                <AccordionSummary\r\n                    expandIcon={<ExpandMoreIcon/>}\r\n                    aria-controls=\"particle-renderer-content\"\r\n                    id=\"particle-renderer-header\">\r\n                    <Typography className={classes.heading}>Particle Renderer</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <ApplicationContextConsumer>\r\n                        {context => context &&\r\n                            <ParticleRendererProperties particleSystem={(props.object3d as ParticleEmitter).system}\r\n                                                        updateProperties={context.actions.updateProperties}/>\r\n                        }\r\n                    </ApplicationContextConsumer>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n            }\r\n            {(props.object3d instanceof ParticleEmitter) &&\r\n            <Accordion>\r\n                <AccordionSummary\r\n                    expandIcon={<ExpandMoreIcon/>}\r\n                    aria-controls=\"particle-emitter-content\"\r\n                    id=\"particle-emitter-header\">\r\n                    <Typography className={classes.heading}>Particle Emitter</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <ApplicationContextConsumer>\r\n                        {context => context &&\r\n                            <ParticleSystemProperties particleSystem={(props.object3d as ParticleEmitter).system}\r\n                                                      updateProperties={context.actions.updateProperties}/>\r\n                        }\r\n                    </ApplicationContextConsumer>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n            }\r\n            {(props.object3d instanceof ParticleEmitter) &&\r\n            <Accordion>\r\n                <AccordionSummary\r\n                    expandIcon={<ExpandMoreIcon/>}\r\n                    aria-controls=\"behaviors-content\"\r\n                    id=\"behaviors-header\">\r\n                    <Typography className={classes.heading}>Behaviors</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <ApplicationContextConsumer>\r\n                        {context => context &&\r\n                            <BehaviorsProperties particleSystem={(props.object3d as ParticleEmitter).system}\r\n                                                        updateProperties={context.actions.updateProperties}/>\r\n                        }\r\n                    </ApplicationContextConsumer>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n            }\r\n            <Accordion>\r\n                <AccordionSummary\r\n                    expandIcon={<ExpandMoreIcon/>}\r\n                    aria-controls=\"script-content\"\r\n                    id=\"script-header\"\r\n                >\r\n                    <Typography className={classes.heading}>Script</Typography>\r\n                </AccordionSummary>\r\n                <AccordionDetails>\r\n                    <ApplicationContextConsumer>\r\n                        {context => context &&\r\n                            <ScriptProperties object3d={props.object3d}\r\n                                              updateProperties={context.actions.updateProperties}/>\r\n                        }\r\n                    </ApplicationContextConsumer>\r\n                </AccordionDetails>\r\n            </Accordion>\r\n        </div>\r\n    );\r\n}\r\n/*\r\n<Accordion.Title active={activeIndex === 1} index={1} onClick={this.handleClick}>\r\n    <Icon name='dropdown'/>\r\n    Emission\r\n</Accordion.Title>\r\n<Accordion.Content active={activeIndex === 1}>\r\n<div><GeneratorEditor name=\"startSpeed\"\r\nallowedType={['value', 'function'] as Array<ValueType>}\r\ngenerator={this.state.valueGenerator}\r\nupdateGenerator={g => this.setState({valueGenerator: g})}/></div>\r\n<div><GeneratorEditor name=\"startColor\"\r\nallowedType={['color', 'functionColor'] as Array<ValueType>}\r\ngenerator={this.state.colorGenerator}\r\nupdateGenerator={g => this.setState({colorGenerator: g})}/></div>\r\n</Accordion.Content>\r\n\r\n<Accordion.Title active={activeIndex === 2} index={2} onClick={this.handleClick}>\r\n    <Icon name='dropdown'/>\r\n    Renderer\r\n    </Accordion.Title>\r\n    <Accordion.Content active={activeIndex === 2}>\r\n</Accordion.Content>\r\n\r\n<Accordion.Title active={activeIndex === 3} index={3} onClick={this.handleClick}>\r\n    <Icon name='dropdown'/>\r\n    Emission Shape\r\n</Accordion.Title>\r\n<Accordion.Content active={activeIndex === 3}>\r\n<Select placeholder='Emitter' options={this.emitterOptions}/>\r\n</Accordion.Content>*/\r\n","import React from \"react\";\r\nimport {AppContext, ApplicationContextConsumer} from \"./ApplicationContext\";\r\nimport {Object3D, Scene} from \"three\";\r\nimport {ParticleSystem} from \"three.quarks\";\r\nimport {ParticleEmitter} from \"three.quarks\";\r\nimport './SceneGraphView.scss';\r\nimport {Item, Menu, MenuProvider, Separator, Submenu} from \"react-contexify\";\r\nimport {MenuItemEventHandler} from \"react-contexify/lib/types\";\r\nimport 'react-contexify/dist/ReactContexify.min.css';\r\nimport {TreeView} from \"@material-ui/lab\";\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport {makeStyles, createStyles} from \"@material-ui/core\";\r\nimport TreeItem from \"@material-ui/lab/TreeItem\";\r\nimport {Theme, Typography} from \"@material-ui/core\";\r\nimport AccordionSummary from \"@material-ui/core/AccordionSummary\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            height: 240,\r\n            flexGrow: 1,\r\n        },\r\n        heading: {\r\n            fontSize: theme.typography.pxToRem(15),\r\n            fontWeight: theme.typography.fontWeightRegular,\r\n        },\r\n    }),\r\n);\r\n\r\n/*\r\ninterface SceneGraphItemViewProps {\r\n    selected: boolean;\r\n    object3d: Object3D;\r\n    onClick: (a: React.MouseEvent) => void;\r\n    indent: number;\r\n}*/\r\n/*\r\nconst SceneGraphItemView: React.FC<SceneGraphItemViewProps> = (props) => {\r\n\r\n    const getObjectName = (object3d: Object3D) => {\r\n        let type = 'object';\r\n        if (object3d instanceof ParticleEmitter) {\r\n            type = 'ParticleSystem';\r\n        } else {\r\n            type =  object3d.type;\r\n        }\r\n        let name = 'unnamed';\r\n        if (object3d.name) {\r\n            name = object3d.name;\r\n        }\r\n        return `[${type}] ${name}`;\r\n    };\r\n\r\n    let className = 'item';\r\n    if (props.selected) {\r\n        className += ' selected';\r\n    }\r\n\r\n    return <MenuProvider id=\"scene-graph-menu\" data={{object3d: props.object3d}}>\r\n        <li className={className} onClick={props.onClick} style={{marginLeft: props.indent + 'em'}}>\r\n        {getObjectName(props.object3d)}\r\n        </li>\r\n    </MenuProvider>;\r\n};*/\r\n\r\ninterface SceneGraphViewMaterialProps {\r\n    context: AppContext\r\n    scene: Scene;\r\n}\r\n\r\nexport function SceneGraphViewMaterial(props: SceneGraphViewMaterialProps) {\r\n    const classes = useStyles();\r\n\r\n    const [selected, setSelected] = React.useState<string[]>([]);\r\n\r\n    const countIndex = (index: number, object3d: Object3D): Object3D | null => {\r\n        if (index == 0)\r\n            return object3d;\r\n        index --;\r\n        for (const child of object3d.children) {\r\n            const res = countIndex(index, child);\r\n            if (res)\r\n                return res;\r\n            index --;\r\n        }\r\n        return null;\r\n    }\r\n    const handleSelect = (event: React.ChangeEvent<{}>, nodeIds: string[]) => {\r\n        if (nodeIds.length > 0) {\r\n            const index = parseInt(nodeIds[0]);\r\n            const object3d = countIndex(index, props.scene);\r\n            if (object3d)\r\n                props.context.actions.select(object3d);\r\n        }\r\n        setSelected(nodeIds);\r\n    };\r\n\r\n    const getObjectName = (object3d: Object3D) => {\r\n        let type = 'object';\r\n        if (object3d instanceof ParticleEmitter) {\r\n            type = 'ParticleSystem';\r\n        } else {\r\n            type =  object3d.type;\r\n        }\r\n        let name = 'unnamed';\r\n        if (object3d.name) {\r\n            name = object3d.name;\r\n        }\r\n        return `[${type}] ${name}`;\r\n    };\r\n\r\n    const renderObject = (context: AppContext, object3d: THREE.Object3D, index: number): [React.ReactNode, number] => {\r\n        const items = [];\r\n\r\n        const originIndex = index;\r\n        index ++;\r\n        for (const child of object3d.children) {\r\n            const result = renderObject(context, child, index);\r\n            items.push(result[0]);\r\n            index = result[1];\r\n        }\r\n        //selected={context.selection.indexOf(object3d) !== -1}\r\n        return  [<TreeItem key={object3d.uuid} nodeId={\"\" + originIndex} label={getObjectName(object3d)} >\r\n            {items}\r\n        </TreeItem>, index];\r\n    }\r\n\r\n    const onContextMenuClick = ({event, props}: MenuItemEventHandler) => console.log(event,props);\r\n\r\n    const onContextMenuAddParticleSystem = ({event, props: sceneObj}: MenuItemEventHandler) => {\r\n        if ((sceneObj as any).object3d) {\r\n            props.context.actions.addObject3d('particle', (props! as any).object3d);\r\n        }\r\n    };\r\n    const onContextMenuRemove = ({event, props: sceneObj}: MenuItemEventHandler) => {\r\n        if ((sceneObj as any).object3d) {\r\n            props.context.actions.removeObject3d((props! as any).object3d);\r\n        }\r\n    };\r\n\r\n    const onContextMenuExport = ({event, props: sceneObj}: MenuItemEventHandler) => {\r\n        if ((sceneObj! as any).object3d) {\r\n            const a = document.createElement(\"a\");\r\n            const json = (props! as any).object3d.toJSON();\r\n            //json.images.forEach((image: any) => image.url = \"http://localhost:3000/textures/texture1.png\");\r\n            const file = new Blob([JSON.stringify(json)], {type: \"application/json\"});\r\n            a.href = URL.createObjectURL(file);\r\n            a.download = \"scene.json\";\r\n            a.click();\r\n        }\r\n    };\r\n\r\n    const renderScene = (context: AppContext, scene: THREE.Scene) => {\r\n        return <TreeView\r\n            className={classes.root}\r\n            selected={selected}\r\n            onNodeSelect={handleSelect}\r\n            defaultCollapseIcon={<ExpandMoreIcon />}\r\n            defaultExpandIcon={<ChevronRightIcon />}\r\n        >\r\n            {renderObject(context, scene, 0)[0]}\r\n        </TreeView>;\r\n    }\r\n\r\n    return <div>\r\n        <Typography className={classes.heading}> Scene Graph </Typography>\r\n        {renderScene(props.context, props.scene)}\r\n        <Menu id=\"scene-graph-menu\">\r\n            <Submenu label=\"Add\">\r\n                <Item onClick={onContextMenuAddParticleSystem}>Particle System</Item>\r\n                <Item onClick={onContextMenuClick}>Ball</Item>\r\n            </Submenu>\r\n            <Separator />\r\n            <Item onClick={onContextMenuRemove}>Remove</Item>\r\n            <Separator />\r\n            <Item onClick={onContextMenuExport}>Export</Item>\r\n            <Item disabled>Dolor</Item>\r\n        </Menu>\r\n    </div>;\r\n}\r\n","import * as React from \"react\";\r\nimport MainMenu from \"./MainMenu\";\r\nimport {ThreejsViewport} from \"./ThreejsViewport\";\r\nimport PropertiesEditor from \"./PropertiesEditor\";\r\nimport {SceneGraphView} from \"./SceneGraphView\";\r\n\r\nimport './layout.scss';\r\nimport {ApplicationContextConsumer, ApplicationContextProvider} from \"./ApplicationContext\";\r\nimport {SceneGraphViewMaterial} from \"./SceneGraphViewMaterial\";\r\n\r\nexport class Application extends React.Component<{}> {\r\n\r\n    constructor(props: Readonly<{}>) {\r\n        super(props);\r\n    }\r\n\r\n    render() {\r\n        console.log(\"render application\");\r\n        return (\r\n            <ApplicationContextProvider>\r\n                <div className=\"application\">\r\n                    <div className=\"main-menu\">\r\n                        <ApplicationContextConsumer>\r\n                            {context => context &&\r\n                                <MainMenu onSaveAs={context.actions.onSaveAs}\r\n                                            onImport={context.actions.onImport}\r\n                                            onOpenDemo={context.actions.onOpenDemo}/>\r\n                            }\r\n                        </ApplicationContextConsumer>\r\n                    </div>\r\n                    <div className=\"main\">\r\n                        <div className=\"viewport\">\r\n                            <ThreejsViewport width={600} height={600}/>\r\n                        </div>\r\n                        <div className=\"sidebar\">\r\n                            <ApplicationContextConsumer>\r\n                                {\r\n                                    context => context && <SceneGraphViewMaterial context={context} scene={context.scene} />\r\n                                }\r\n                            </ApplicationContextConsumer>\r\n                            <ApplicationContextConsumer>\r\n                                { context => context && context.selection.length > 0 &&\r\n                                    <PropertiesEditor object3d={context.selection[0]}/>\r\n                                }\r\n                            </ApplicationContextConsumer>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </ApplicationContextProvider>);\r\n    }\r\n}\r\n","import React, {useState} from 'react';\r\nimport {PiecewiseBezier} from \"three.quarks\";\r\nimport {Application} from \"./components/Application\";\r\nimport {Bezier} from \"three.quarks\";\r\nimport blue from \"@material-ui/core/colors/blue\";\r\nimport red from \"@material-ui/core/colors/red\";\r\nimport createMuiTheme from \"@material-ui/core/styles/createMuiTheme\";\r\nimport { ThemeProvider } from '@material-ui/core';\r\nimport {BezierCurvesEditor} from \"./components/editors/bezier/BezierCurvesEditor\";\r\n\r\nconst theme = createMuiTheme({\r\n    palette: {\r\n        primary: {\r\n            main: blue[500],\r\n        },\r\n        secondary: {\r\n            main: red[500],\r\n        },\r\n    },\r\n    typography: {\r\n        fontSize: 12,\r\n    }\r\n});\r\n\r\nconst App: React.FC = () => {\r\n\r\n  /*const [bezierCurves, setBezierCurves] = useState(\r\n      new PiecewiseBezier([\r\n        [new Bezier(0, 0.5 / 3, 0.5 / 3 * 2, 0.5), 0],\r\n        [new Bezier(0.5, 0.5, 0.5, 0.5), 0.5],\r\n      ])\r\n  );return <div className=\"App\">\r\n        <header className=\"App-header\">\r\n            <BezierCurvesEditor width={200} height={100} value={bezierCurves} onChange={(bezierCurves) => {setBezierCurves(bezierCurves)}}/>\r\n        </header>\r\n    </div>;*/\r\n\r\n    return (<ThemeProvider theme={theme}><Application /></ThemeProvider>);\r\n};\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}